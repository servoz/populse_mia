
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>populse_mia.pipeline_manager.pipeline_editor &#8212; populse_mia 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../index.html">
          <span>populse_mia 1.0.0 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.pipeline_manager.pipeline_editor</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for populse_mia.pipeline_manager.pipeline_editor</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*- #</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="sd">Contains:</span>
<span class="sd">    Class:</span>
<span class="sd">        -</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">TraitError</span>

<span class="c1"># PyQt5 imports</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="p">,</span> <span class="n">QtCore</span>

<span class="c1"># Capsul imports</span>
<span class="kn">from</span> <span class="nn">capsul.api</span> <span class="k">import</span> <span class="n">get_process_instance</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">PipelineNode</span><span class="p">,</span> <span class="n">Switch</span>
<span class="kn">from</span> <span class="nn">capsul.qt_gui.widgets.pipeline_developper_view</span> <span class="k">import</span> \
    <span class="n">PipelineDevelopperView</span><span class="p">,</span> <span class="n">NodeGWidget</span>
<span class="kn">from</span> <span class="nn">capsul.pipeline.xml</span> <span class="k">import</span> <span class="n">save_xml_pipeline</span>
<span class="kn">from</span> <span class="nn">capsul.pipeline.python_export</span> <span class="k">import</span> <span class="n">save_py_pipeline</span>

<span class="c1"># soma-base imports</span>
<span class="kn">from</span> <span class="nn">soma.utils.weak_proxy</span> <span class="k">import</span> <span class="n">weak_proxy</span>

<span class="c1"># Populse_MIA imports</span>
<span class="kn">from</span> <span class="nn">populse_mia.pipeline_manager.node_controller</span> <span class="k">import</span> <span class="n">FilterWidget</span>
<span class="kn">from</span> <span class="nn">populse_mia.pop_ups.pop_up_close_pipeline</span> <span class="k">import</span> <span class="n">PopUpClosePipeline</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties.config</span> <span class="k">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">populse_mia.utils.utils</span> <span class="k">import</span> <span class="n">verCmp</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>


    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="values"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()</span></div>


<div class="viewcode-block" id="PipelineEditorTabs"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs">[docs]</a><span class="k">class</span> <span class="nc">PipelineEditorTabs</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTabWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tab widget that contains pipeline editors</span>

<span class="sd">    Methods:</span>
<span class="sd">        - check_modifications: check if the nodes of the current pipeline have</span>
<span class="sd">           been modified</span>
<span class="sd">        - close_tab: close the selected tab and editor</span>
<span class="sd">        - emit_node_clicked: emit a signal when a node is clicked</span>
<span class="sd">        - emit_pipeline_saved: emit a signal when a pipeline is saved</span>
<span class="sd">        - emit_switch_clicked: emit a signal when a switch is clicked</span>
<span class="sd">        - export_to_db_scans: export the input of a filter to &#39;database_scans&#39;</span>
<span class="sd">        - get_current_editor: get the instance of the current editor</span>
<span class="sd">        - get_current_filename: get the file name of the current pipeline</span>
<span class="sd">        - get_current_pipeline: get the instance of the current pipeline</span>
<span class="sd">        - get_current_tab_name: get the tab title of the current editor</span>
<span class="sd">        - get_filename_by_index: get the pipeline filename from its index in</span>
<span class="sd">           the editors</span>
<span class="sd">        - get_index_by_filename: get the index of the editor corresponding to</span>
<span class="sd">           the given pipeline filename</span>
<span class="sd">        - get_index_by_tab_name: get the index of the editor corresponding to</span>
<span class="sd">           the given tab name</span>
<span class="sd">        - get_tab_name_by_index: get the tab title from its index in the</span>
<span class="sd">           editors</span>
<span class="sd">        - has_pipeline_nodes: check if any of the pipelines in the editor tabs</span>
<span class="sd">           have pipeline nodes</span>
<span class="sd">        - load_pipeline: load a new pipeline</span>
<span class="sd">        - load_pipeline_parameters: load parameters to the pipeline of the</span>
<span class="sd">           current editor</span>
<span class="sd">        - new_tab: create a new tab and a new editor</span>
<span class="sd">        - open_filter: open a filter widget</span>
<span class="sd">        - open_sub_pipeline: open a sub-pipeline in a new tab</span>
<span class="sd">        - reset_pipeline: reset the pipeline of the current editor</span>
<span class="sd">        - save_pipeline: save the pipeline of the current editor</span>
<span class="sd">        - save_pipeline_parameters: save the pipeline parameters of the</span>
<span class="sd">           current editor</span>
<span class="sd">        - set_current_editor_by_tab_name: set the current editor</span>
<span class="sd">        - update_history: update undo/redo history of an editor</span>
<span class="sd">        - update_pipeline_editors: update editors</span>
<span class="sd">        - update_scans_list: update the list of database scans in every editor</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pipeline_saved</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">node_clicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Process</span><span class="p">)</span>
    <span class="n">switch_clicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Switch</span><span class="p">)</span>

<div class="viewcode-block" id="PipelineEditorTabs.__init__"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">scan_list</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization of the Pipeline Editor tabs</span>

<span class="sd">        :param project: current project in the software</span>
<span class="sd">        :param scan_list: list of the selected database files</span>
<span class="sd">        :param main_window: main window of the software</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PipelineEditorTabs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s1">&#39;QTabBar{font-size:12pt;font-family:Arial;&#39;</span>
                           <span class="s1">&#39;text-align: center;color:black;}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabsClosable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabCloseRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close_tab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span> <span class="o">=</span> <span class="n">scan_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">p_e</span> <span class="o">=</span> <span class="n">PipelineEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">node_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">switch_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_switch_clicked</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_pipeline_saved</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_modified</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_pipeline_editors</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">edit_sub_pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_sub_pipeline</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">open_filter</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_filter</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="p">)</span>

        <span class="c1"># Setting a default editor called &quot;New Pipeline&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">p_e</span><span class="p">,</span> <span class="s2">&quot;New Pipeline&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Tool button to add a tab</span>
        <span class="n">tb</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QToolButton</span><span class="p">()</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_tab</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Add tabs by pressing &quot;+&quot;&#39;</span><span class="p">),</span> <span class="nb">str</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabEnabled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabBar</span><span class="p">()</span><span class="o">.</span><span class="n">setTabButton</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QTabBar</span><span class="o">.</span><span class="n">RightSide</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>

        <span class="c1"># Checking if the pipeline nodes have been modified</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabBarClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_modifications</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.new_tab"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.new_tab">[docs]</a>    <span class="k">def</span> <span class="nf">new_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new tab and a new editor and makes the new tab current</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Creating a new editor</span>
        <span class="n">p_e</span> <span class="o">=</span> <span class="n">PipelineEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">node_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">switch_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_switch_clicked</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_pipeline_saved</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_modified</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_pipeline_editors</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">edit_sub_pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_sub_pipeline</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">open_filter</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_filter</span><span class="p">)</span>
        <span class="n">p_e</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="p">)</span>

        <span class="c1"># A unique editor name has to be automatically generated</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;New Pipeline </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Too many tabs in the Pipeline Editor&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insertTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p_e</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.close_tab"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.close_tab">[docs]</a>    <span class="k">def</span> <span class="nf">close_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closes the selected tab and editor</span>

<span class="sd">        :param idx: index of the tab to close</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="c1"># If the pipeline has been modified and not saved</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="n">idx</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot; *&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span> <span class="o">=</span> <span class="n">PopUpClosePipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">save_as_signal</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

            <span class="n">can_exit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">can_exit</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop_up_close</span><span class="o">.</span><span class="n">bool_save_as</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removeTab</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">can_exit</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">can_exit</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeTab</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="c1"># If there is no more editor, adding one</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p_e</span> <span class="o">=</span> <span class="n">PipelineEditor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">node_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_node_clicked</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">switch_clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_switch_clicked</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit_pipeline_saved</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">pipeline_modified</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_pipeline_editors</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">edit_sub_pipeline</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_sub_pipeline</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">open_filter</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_filter</span><span class="p">)</span>
            <span class="n">p_e</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_to_db_scans</span><span class="p">)</span>

            <span class="c1"># Setting a default editor called &quot;New Pipeline&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insertTab</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p_e</span><span class="p">,</span> <span class="s2">&quot;New Pipeline&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">p_e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.set_current_editor_by_tab_name"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.set_current_editor_by_tab_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_editor_by_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current editor</span>

<span class="sd">        :param tab_name: name of the tab</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="n">tab_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.set_current_editor_by_file_name"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.set_current_editor_by_file_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_editor_by_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current editor</span>

<span class="sd">        :param file_name: name of the file the pipeline was last saved to</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.set_current_editor_by_editor"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.set_current_editor_by_editor">[docs]</a>    <span class="k">def</span> <span class="nf">set_current_editor_by_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the current editor</span>

<span class="sd">        :param editor: editor in the tab that should be made current</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_editor</span><span class="p">(</span><span class="n">editor</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_editor_by_index"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_editor_by_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_editor_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the instance of an editor from its index in the editors</span>

<span class="sd">        :param idx: index of the editor</span>
<span class="sd">        :return: the editor corresponding to the index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># last tab has &quot;add tab&quot; button, no editor</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_current_editor"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_current_editor">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the instance of the current editor</span>

<span class="sd">        :return: the current editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_editor_by_tab_name"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_editor_by_tab_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_editor_by_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the instance of an editor from its tab name</span>

<span class="sd">        :param tab_name: name of the tab</span>
<span class="sd">        :return: the editor corresponding to the tab name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_tab_name</span><span class="p">(</span><span class="n">tab_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_editor_by_file_name"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_editor_by_file_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_editor_by_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the instance of an editor from its file name</span>

<span class="sd">        :param file_name: name of the file the pipeline was last saved to</span>
<span class="sd">        :return: the editor corresponding to the file name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_tab_name_by_index"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_tab_name_by_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_tab_name_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the tab name of the editor at the given index.</span>
<span class="sd">        Trailing &quot; \*&quot; and ampersand (&quot;&amp;&quot;) characters are removed.</span>

<span class="sd">        :param idx: index of the editor</span>
<span class="sd">        :return: the tab name corresponding to the index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># last tab has &quot;add tab&quot; button, no tab name</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># remove Qt keyboard shortcut indicator</span>
            <span class="n">tab_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabText</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tab_name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot; *&quot;</span><span class="p">:</span>
                <span class="n">tab_name</span> <span class="o">=</span> <span class="n">tab_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">tab_name</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_current_tab_name"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_current_tab_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the tab name of the editor in the current tab.</span>
<span class="sd">        Trailing &quot; \*&quot; and ampersand (&quot;&amp;&quot;) characters are removed.</span>

<span class="sd">        :return: the current tab name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tab_name_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_filename_by_index"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_filename_by_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_filename_by_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the relative path to the file the pipeline in the editor at the</span>
<span class="sd">           given index has been last saved to.</span>
<span class="sd">        If the pipeline has never been saved, returns the title of the tab.</span>

<span class="sd">        :param idx: index of the editor</span>
<span class="sd">        :return: the file name corresponding to the index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">editor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">editor</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_current_filename"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_current_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the relative path to the file the pipeline in the current editor</span>
<span class="sd">           has been last saved to.</span>
<span class="sd">        If the pipeline has never been saved, returns the title of the tab.</span>

<span class="sd">        :return: the filename of the current editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_index_by_tab_name"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_index_by_tab_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_index_by_tab_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tab_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the index of the editor corresponding to the given tab name</span>

<span class="sd">        :param tab_name: name of the tab with the searched pipeline</span>
<span class="sd">        :return: the index corresponding to the tab name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tab_name_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">tab_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_index_by_filename"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_index_by_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_index_by_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the index of the first editor corresponding to the given</span>
<span class="sd">           pipeline filename</span>

<span class="sd">        :param filename: filename of the searched pipeline</span>
<span class="sd">        :return: the index corresponding to the file name</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># we always store file names as relative paths</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_index_by_editor"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_index_by_editor">[docs]</a>    <span class="k">def</span> <span class="nf">get_index_by_editor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the index of the editor corresponding to the given editor</span>

<span class="sd">        :param editor: searched pipeline editor</span>
<span class="sd">        :return: the index corresponding to the editor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="n">editor</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">idx</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.get_current_pipeline"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.get_current_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the instance of the current pipeline</span>

<span class="sd">        :return: the pipeline of the current editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.save_pipeline"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.save_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">save_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves the pipeline of the current editor.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Doing a &quot;Save as&quot; action</span>
            <span class="n">new_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">save_pipeline</span><span class="p">())</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">new_file_name</span> <span class="ow">and</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_filename</span><span class="p">())</span> <span class="o">!=</span> <span class="n">new_file_name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="n">new_file_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Saving the current pipeline</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">posdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">y</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span>
                     <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="p">)])</span>

            <span class="k">except</span><span class="p">:</span>  <span class="c1"># add by Irmage OM</span>
                <span class="n">posdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span>
                     <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="p">)])</span>

            <span class="c1"># add by Irmage OM</span>
            <span class="n">dimdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span>
                 <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">dim</span><span class="p">)])</span>

            <span class="c1"># add by Irmage OM</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">node_dimension</span> <span class="o">=</span> <span class="n">dimdict</span>

            <span class="n">old_pos</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span> <span class="o">=</span> <span class="n">posdict</span>
            <span class="n">save_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">new_file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_pipeline_filename</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span>
                <span class="n">new_file_name</span><span class="p">)</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span> <span class="o">=</span> <span class="n">old_pos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">new_file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">new_file_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.load_pipeline"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.load_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">load_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a new pipeline</span>

<span class="sd">        :param filename: not None only when this method is called from</span>
<span class="sd">          &quot;open_sub_pipeline&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">current_tab_not_empty</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">new_tab_opened</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Open new tab if the current PipelineEditor is not empty</span>
            <span class="k">if</span> <span class="n">current_tab_not_empty</span><span class="p">:</span>
                <span class="c1"># create new tab with new editor and make it current</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
                <span class="n">working_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
                <span class="n">new_tab_opened</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># get only the file name to load</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># Check if this pipeline is already open</span>
            <span class="n">existing_pipeline_tab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_by_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">existing_pipeline_tab</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">existing_pipeline_tab</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># we need to actually load the pipeline</span>
                <span class="k">if</span> <span class="n">current_tab_not_empty</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">new_tab_opened</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">new_tab</span><span class="p">()</span>
                    <span class="n">new_tab_opened</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="n">working_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
                <span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_editor_by_index</span><span class="p">(</span><span class="n">working_index</span><span class="p">)</span>
                <span class="c1"># actually load the pipeline</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="n">working_index</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_scans_list</span><span class="p">()</span>
                    <span class="k">return</span>  <span class="c1"># success</span>

        <span class="c1"># if we&#39;re still here, something went wrong. clean up.</span>
        <span class="k">if</span> <span class="n">new_tab_opened</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_tab</span><span class="p">(</span><span class="n">working_index</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.save_pipeline_parameters"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.save_pipeline_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">save_pipeline_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the pipeline parameters of the current editor</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">save_pipeline_parameters</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.load_pipeline_parameters"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.load_pipeline_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">load_pipeline_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads parameters to the pipeline of the current editor</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">load_pipeline_parameters</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.emit_node_clicked"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.emit_node_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">emit_node_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when a node is clicked</span>

<span class="sd">        :param node_name: node name</span>
<span class="sd">        :param process: process of the corresponding node</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">node_clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.emit_switch_clicked"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.emit_switch_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">emit_switch_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">switch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when a switch is clicked</span>

<span class="sd">        :param node_name: node name</span>
<span class="sd">        :param switch: process of the corresponding node</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">switch_clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">switch</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.emit_pipeline_saved"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.emit_pipeline_saved">[docs]</a>    <span class="k">def</span> <span class="nf">emit_pipeline_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits a signal when a pipeline is saved</span>

<span class="sd">        :param filename: file name of the pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.update_pipeline_editors"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.update_pipeline_editors">[docs]</a>    <span class="k">def</span> <span class="nf">update_pipeline_editors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update editors</span>

<span class="sd">        :param editor: editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">editor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_scans_list</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.update_history"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.update_history">[docs]</a>    <span class="k">def</span> <span class="nf">update_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates undo/redo history of an editor</span>

<span class="sd">        :param editor: editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">undos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="p">[</span><span class="n">editor</span><span class="p">]</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">redos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">(),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_tab_name</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; *&quot;</span><span class="p">)</span>  <span class="c1"># make sure the &quot; *&quot; is there</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.reset_pipeline"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.reset_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">reset_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the pipeline of the current editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">_reset_pipeline</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.update_scans_list"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.update_scans_list">[docs]</a>    <span class="k">def</span> <span class="nf">update_scans_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the list of database scans in every editor</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">node_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">plug_name</span> <span class="o">==</span> <span class="s2">&quot;database_scans&quot;</span><span class="p">:</span>
                                <span class="n">node</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span><span class="n">plug_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.open_sub_pipeline"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.open_sub_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">open_sub_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_pipeline</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a sub-pipeline in a new tab.</span>

<span class="sd">        :param sub_pipeline: the pipeline to open</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Reading the process configuration file</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                               <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                    <span class="n">dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
                <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">sub_pipeline_name</span> <span class="o">=</span> <span class="n">sub_pipeline</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># get_path returns a list that is the package path to</span>
        <span class="c1"># the sub_pipeline file</span>
        <span class="n">sub_pipeline_list</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="n">sub_pipeline_name</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;Packages&#39;</span><span class="p">])</span>
        <span class="n">sub_pipeline_name</span> <span class="o">=</span> <span class="n">sub_pipeline_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

        <span class="c1"># Finding the real sub-pipeline filename</span>
        <span class="n">sub_pipeline_filename</span> <span class="o">=</span> <span class="n">find_filename</span><span class="p">(</span>
            <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;Paths&#39;</span><span class="p">],</span> <span class="n">sub_pipeline_list</span><span class="p">,</span> <span class="n">sub_pipeline_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_pipeline</span><span class="p">(</span><span class="n">sub_pipeline_filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.open_filter"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.open_filter">[docs]</a>    <span class="k">def</span> <span class="nf">open_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a filter widget</span>

<span class="sd">        :param node_name: name of the corresponding node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_widget</span> <span class="o">=</span> <span class="n">FilterWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.export_to_db_scans"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.export_to_db_scans">[docs]</a>    <span class="k">def</span> <span class="nf">export_to_db_scans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the input of a filter to &quot;database_scans&quot; plug</span>

<span class="sd">        :param node_name:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If database_scans is already a pipeline global input, the plug</span>
        <span class="c1"># cannot be exported. A link as to be added between database_scans</span>
        <span class="c1"># and the input of the filter.</span>
        <span class="k">if</span> <span class="s1">&#39;database_scans&#39;</span> <span class="ow">in</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">user_traits</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="s1">&#39;database_scans-&gt;</span><span class="si">{0}</span><span class="s1">&#39;</span>
                                                 <span class="s1">&#39;.input&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_current_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">export_parameter</span><span class="p">(</span>
                <span class="n">node_name</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span>
                <span class="n">pipeline_parameter</span><span class="o">=</span><span class="s1">&#39;database_scans&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_current_editor</span><span class="p">()</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.check_modifications"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.check_modifications">[docs]</a>    <span class="k">def</span> <span class="nf">check_modifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the nodes of the current pipeline have been modified</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If the user click on the last tab (with the &#39;+&#39;),</span>
        <span class="c1"># it will throw an AttributeError</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">current_index</span><span class="p">)</span><span class="o">.</span><span class="n">check_modifications</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="PipelineEditorTabs.has_pipeline_nodes"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditorTabs.has_pipeline_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">has_pipeline_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if any of the pipelines in the editor tabs have pipeline nodes</span>

<span class="sd">        :return: True or False depending on if there are nodes in the editors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
            <span class="n">p_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p_e</span><span class="p">,</span> <span class="s1">&#39;scene&#39;</span><span class="p">):</span>
                <span class="c1"># if the widget is a tab editor</span>
                <span class="k">if</span> <span class="n">p_e</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plugs</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="PipelineEditor"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor">[docs]</a><span class="k">class</span> <span class="nc">PipelineEditor</span><span class="p">(</span><span class="n">PipelineDevelopperView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View to edit a pipeline graphically</span>

<span class="sd">    Methods:</span>
<span class="sd">        - _del_link: deletes a link</span>
<span class="sd">        - _export_plug: export a plug to a pipeline global input or output</span>
<span class="sd">        - _release_grab_link: method called when a link is released</span>
<span class="sd">        - _remove_plug: removes a plug</span>
<span class="sd">        - add_link: add a link between two nodes</span>
<span class="sd">        - add_process: adds a process to the pipeline</span>
<span class="sd">        - check_modifications: checks if the nodes of the pipeline have been</span>
<span class="sd">           modified</span>
<span class="sd">        - del_node: deletes a node</span>
<span class="sd">        - dragEnterEvent: event handler when the mouse enters the widget</span>
<span class="sd">        - dragMoveEvent: event handler when the mouse moves in the widget</span>
<span class="sd">        - dropEvent: event handler when something is dropped in the widget</span>
<span class="sd">        - export_node_plugs: exports all the plugs of a node</span>
<span class="sd">        - find_process: finds the dropped process in the system&#39;s paths</span>
<span class="sd">        - get_current_filename: returns the relative path the pipeline was</span>
<span class="sd">           last saved to. Empty if never saved.</span>
<span class="sd">        - save_pipeline: saves the pipeline</span>
<span class="sd">        - update_history: updates the history for undos and redos</span>
<span class="sd">        - update_node_name: updates a node name</span>
<span class="sd">        - update_plug_value: updates a plug value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pipeline_saved</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">pipeline_modified</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="n">PipelineDevelopperView</span><span class="p">)</span>

<div class="viewcode-block" id="PipelineEditor.__init__"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">main_window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization of the PipelineEditor</span>

<span class="sd">        :param project: current project in the software</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">PipelineDevelopperView</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">allow_open_controller</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">show_sub_pipelines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">enable_edition</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>

        <span class="c1"># Undo/Redo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redos</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PipelineEditor.dragEnterEvent"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.dragEnterEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dragEnterEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler when the mouse enters the widget</span>

<span class="sd">        :param event: event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">hasFormat</span><span class="p">(</span><span class="s1">&#39;component/name&#39;</span><span class="p">):</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditor.dragMoveEvent"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.dragMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dragMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler when the mouse moves in the widget</span>

<span class="sd">        :param event: event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">hasFormat</span><span class="p">(</span><span class="s1">&#39;component/name&#39;</span><span class="p">):</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditor.dropEvent"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.dropEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dropEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler when something is dropped in the widget</span>
<span class="sd">        :param event: event</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">hasFormat</span><span class="p">(</span><span class="s1">&#39;component/name&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">click_pos</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QCursor</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;component/name&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_process</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditor.find_process"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.find_process">[docs]</a>    <span class="k">def</span> <span class="nf">find_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the dropped process in the system&#39;s paths</span>

<span class="sd">        :param path: class&#39;s path (e.g. &quot;nipype.interfaces.spm.Smooth&quot;) (str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">package_name</span><span class="p">,</span> <span class="n">process_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">process_name</span> <span class="o">=</span> <span class="n">process_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
        <span class="n">pkg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">package_name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">instance</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">process_name</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">process</span> <span class="o">=</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
                    <span class="n">QtGui</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditor.update_history"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.update_history">[docs]</a>    <span class="k">def</span> <span class="nf">update_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the history for undos and redos.</span>
<span class="sd">        This method is called after each action in the PipelineEditor.</span>

<span class="sd">        :param history_maker: list that contains information about what has</span>
<span class="sd">            been done</span>
<span class="sd">        :param from_undo: boolean that is True if the action has been made</span>
<span class="sd">            using an undo</span>
<span class="sd">        :param from_redo: boolean that is True if the action has been made</span>
<span class="sd">            using a redo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">from_undo</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">undos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">history_maker</span><span class="p">)</span>
            <span class="c1"># If the action does not come from an undo or a redo,</span>
            <span class="c1"># the redos has to be cleared</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">from_redo</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redos</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_modified</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="PipelineEditor.add_process"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.add_process">[docs]</a>    <span class="k">def</span> <span class="nf">add_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_process</span><span class="p">,</span> <span class="n">node_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">links</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a process to the pipeline.</span>

<span class="sd">        :param class_process: process class&#39;s name (str)</span>
<span class="sd">        :param node_name: name of the corresponding node (using when undo/redo) (str)</span>
<span class="sd">        :param from_undo: boolean that is True if the action has been made using an undo</span>
<span class="sd">        :param from_redo: boolean that is True if the action has been made using a redo</span>
<span class="sd">        :param links: list of links (using when undo/redo)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_name</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_process</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">node_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">node_name</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">node_name</span> <span class="o">=</span> <span class="n">class_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">process_to_use</span> <span class="o">=</span> <span class="n">class_process</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">process_to_use</span> <span class="o">=</span> <span class="n">class_process</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">process</span> <span class="o">=</span> <span class="n">get_process_instance</span><span class="p">(</span>
                <span class="n">process_to_use</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="s1">&#39;use_project&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">process</span><span class="o">.</span><span class="n">use_project</span><span class="p">:</span>
            <span class="n">process</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">add_process</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">process</span><span class="p">)</span>

        <span class="c1"># Capsul update</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>
        <span class="n">gnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="n">gnode</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapToScene</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapFromGlobal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">click_pos</span><span class="p">)))</span>

        <span class="c1"># If the process is added from a undo, all the links</span>
        <span class="c1"># that were connected to the corresponding node has to be reset</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">active</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">weak</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">weak</span><span class="p">)</span>
            <span class="c1"># Writing a string to represent the link</span>
            <span class="n">source_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="n">dest_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
            <span class="n">link_to_add</span> <span class="o">=</span> <span class="s2">&quot;-&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">source_parameters</span><span class="p">,</span> <span class="n">dest_parameters</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">link_to_add</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;add_process&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">from_undo</span><span class="p">:</span>
            <span class="c1"># Adding the arguments to make the redo correctly</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Adding the arguments to make the undo correctly</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
            <span class="n">history_maker</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">class_process</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s2">&quot;Node </span><span class="si">{0}</span><span class="s2"> has been added.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditor.del_node"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.del_node">[docs]</a>    <span class="k">def</span> <span class="nf">del_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a node.</span>

<span class="sd">        :param node_name: name of the corresponding node (using when undo/redo)</span>
<span class="sd">        :param from_undo: boolean, True if the action has been made using an</span>
<span class="sd">           undo</span>
<span class="sd">        :param from_redo: boolean, True if the action has been made using a</span>
<span class="sd">           redo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_name</span><span class="p">:</span>
            <span class="n">node_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_node_name</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>

        <span class="c1"># Collecting the links from the node that is being deleted</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">link_to</span> <span class="ow">in</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_to</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_parameter</span><span class="p">,</span> <span class="n">dest_node</span><span class="p">,</span> <span class="n">dest_plug</span><span class="p">,</span>
                     <span class="n">weak_link</span><span class="p">)</span> <span class="o">=</span> <span class="n">link_to</span>
                    <span class="n">active</span> <span class="o">=</span> <span class="n">plug</span><span class="o">.</span><span class="n">activated</span>

                    <span class="c1"># Looking for the name of dest_plug in dest_node</span>
                    <span class="n">dest_plug_name</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">plug_name_d</span><span class="p">,</span> <span class="n">plug_d</span> <span class="ow">in</span> <span class="n">dest_node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">plug_d</span> <span class="o">==</span> <span class="n">dest_plug</span><span class="p">:</span>
                            <span class="n">dest_plug_name</span> <span class="o">=</span> <span class="n">plug_name_d</span>
                            <span class="k">break</span>

                    <span class="n">link_to_add</span> <span class="o">=</span> <span class="p">[(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">)]</span>
                    <span class="n">link_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_plug_name</span><span class="p">))</span>
                    <span class="n">link_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
                    <span class="n">link_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weak_link</span><span class="p">)</span>

                    <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_to_add</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">link_from</span> <span class="ow">in</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_from</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">source_node_name</span><span class="p">,</span> <span class="n">source_parameter</span><span class="p">,</span> <span class="n">source_node</span><span class="p">,</span>
                     <span class="n">source_plug</span><span class="p">,</span> <span class="n">weak_link</span><span class="p">)</span> <span class="o">=</span> <span class="n">link_from</span>
                    <span class="n">active</span> <span class="o">=</span> <span class="n">plug</span><span class="o">.</span><span class="n">activated</span>

                    <span class="c1"># Looking for the name of source_plug in source_node</span>
                    <span class="n">source_plug_name</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">for</span> <span class="n">plug_name_d</span><span class="p">,</span> <span class="n">plug_d</span> <span class="ow">in</span> <span class="n">source_node</span><span class="o">.</span><span class="n">plugs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">plug_d</span> <span class="o">==</span> <span class="n">source_plug</span><span class="p">:</span>
                            <span class="n">source_plug_name</span> <span class="o">=</span> <span class="n">plug_name_d</span>
                            <span class="k">break</span>

                    <span class="n">link_to_add</span> <span class="o">=</span> <span class="p">[(</span><span class="n">source_node_name</span><span class="p">,</span> <span class="n">source_plug_name</span><span class="p">)]</span>
                    <span class="n">link_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node_name</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">))</span>
                    <span class="n">link_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">active</span><span class="p">)</span>
                    <span class="n">link_to_add</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weak_link</span><span class="p">)</span>

                    <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link_to_add</span><span class="p">)</span>

        <span class="c1"># Calling the original method</span>
        <span class="n">PipelineDevelopperView</span><span class="o">.</span><span class="n">del_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">)</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;delete_process&quot;</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span><span class="p">,</span> <span class="n">links</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s2">&quot;Node </span><span class="si">{0}</span><span class="s2"> has been deleted.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_release_grab_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">ret</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called when a link is released</span>
<span class="sd">        :param event: mouse event corresponding to the release</span>
<span class="sd">        :param ret: boolean that is set to True in the original method to</span>
<span class="sd">           return the link</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Calling the original method</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">PipelineDevelopperView</span><span class="o">.</span><span class="n">_release_grab_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">ret</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;add_link&quot;</span><span class="p">,</span> <span class="n">link</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;Link </span><span class="si">{0}</span><span class="s1"> has been added.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>

<div class="viewcode-block" id="PipelineEditor.add_link"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.add_link">[docs]</a>    <span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">weak</span><span class="p">,</span>
                 <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a link between two nodes.</span>

<span class="sd">        :param source: tuple containing the node and plug source names</span>
<span class="sd">        :param dest: tuple containing the node and plug destination names</span>
<span class="sd">        :param active: boolean that is True if the link is activated</span>
<span class="sd">        :param weak: boolean that is True if the link is weak</span>
<span class="sd">        :param from_undo: boolean that is True if the action has been made</span>
<span class="sd">           using an undo</span>
<span class="sd">        :param from_redo: boolean that is True if the action has been made</span>
<span class="sd">           using a redo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">weak</span><span class="p">)</span>

        <span class="c1"># Writing a string to represent the link</span>
        <span class="n">source_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="n">dest_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;-&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">source_parameters</span><span class="p">,</span> <span class="n">dest_parameters</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;add_link&quot;</span><span class="p">,</span> <span class="n">link</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;Link </span><span class="si">{0}</span><span class="s1"> has been added.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_del_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a link.</span>

<span class="sd">        :param link: string representation of a link</span>
<span class="sd">           (e.g. &quot;process1.out-&gt;process2.in&quot;)</span>
<span class="sd">        :param from_undo: boolean, True if the action has been made using an</span>
<span class="sd">           undo</span>
<span class="sd">        :param from_redo: boolean, True if the action has been made using a</span>
<span class="sd">           redo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_link</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_link</span> <span class="o">=</span> <span class="n">link</span>

        <span class="p">(</span><span class="n">source_node_name</span><span class="p">,</span> <span class="n">source_plug_name</span><span class="p">,</span> <span class="n">source_node</span><span class="p">,</span>
         <span class="n">source_plug</span><span class="p">,</span> <span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_plug_name</span><span class="p">,</span> <span class="n">dest_node</span><span class="p">,</span>
         <span class="n">dest_plug</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">parse_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>

        <span class="p">(</span><span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_parameter</span><span class="p">,</span> <span class="n">dest_node</span><span class="p">,</span> <span class="n">dest_plug</span><span class="p">,</span>
         <span class="n">weak_link</span><span class="p">)</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">source_plug</span><span class="o">.</span><span class="n">links_to</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">active</span> <span class="o">=</span> <span class="n">source_plug</span><span class="o">.</span><span class="n">activated</span> <span class="ow">and</span> <span class="n">dest_plug</span><span class="o">.</span><span class="n">activated</span>

        <span class="c1"># Calling the original method</span>
        <span class="n">PipelineDevelopperView</span><span class="o">.</span><span class="n">_del_link</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;delete_link&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">source_node_name</span><span class="p">,</span> <span class="n">source_plug_name</span><span class="p">),</span>
                         <span class="p">(</span><span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_plug_name</span><span class="p">),</span> <span class="n">active</span><span class="p">,</span> <span class="n">weak_link</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;Link </span><span class="si">{0}</span><span class="s1"> has been deleted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>

<div class="viewcode-block" id="PipelineEditor.update_node_name"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.update_node_name">[docs]</a>    <span class="k">def</span> <span class="nf">update_node_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">,</span> <span class="n">old_node_name</span><span class="p">,</span> <span class="n">new_node_name</span><span class="p">,</span>
                         <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a node name.</span>

<span class="sd">        :param old_node: Node object to change</span>
<span class="sd">        :param old_node_name: original name of the node (str)</span>
<span class="sd">        :param new_node_name: new name of the node (str)</span>
<span class="sd">        :param from_undo: boolean, True if the action has been made using an</span>
<span class="sd">           undo</span>
<span class="sd">        :param from_redo: boolean, True if the action has been made using a</span>
<span class="sd">           redo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>

        <span class="c1"># Removing links of the selected node and copy the origin/destination</span>
        <span class="n">links_to_copy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">source_parameter</span><span class="p">,</span> <span class="n">source_plug</span> \
                <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">plugs</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_parameter</span><span class="p">,</span> <span class="n">dest_node</span><span class="p">,</span> <span class="n">dest_plug</span><span class="p">,</span>
                 <span class="n">weak_link</span><span class="p">)</span> <span class="ow">in</span> <span class="n">source_plug</span><span class="o">.</span><span class="n">links_to</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">remove_link</span><span class="p">(</span><span class="n">old_node_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">source_parameter</span> <span class="o">+</span>
                                     <span class="s2">&quot;-&gt;&quot;</span> <span class="o">+</span> <span class="n">dest_node_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span>
                                     <span class="n">dest_parameter</span><span class="p">)</span>
                <span class="n">links_to_copy</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">source_parameter</span><span class="p">,</span>
                                      <span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_parameter</span><span class="p">))</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">dest_node_name</span><span class="p">,</span> <span class="n">dest_parameter</span><span class="p">,</span> <span class="n">dest_node</span><span class="p">,</span> <span class="n">dest_plug</span><span class="p">,</span>
                 <span class="n">weak_link</span><span class="p">)</span> <span class="ow">in</span> <span class="n">source_plug</span><span class="o">.</span><span class="n">links_from</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">remove_link</span><span class="p">(</span><span class="n">dest_node_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">dest_parameter</span> <span class="o">+</span>
                                     <span class="s2">&quot;-&gt;&quot;</span> <span class="o">+</span> <span class="n">old_node_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span>
                                     <span class="n">source_parameter</span><span class="p">)</span>
                <span class="n">links_to_copy</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="n">source_parameter</span><span class="p">,</span> <span class="n">dest_node_name</span><span class="p">,</span>
                                      <span class="n">dest_parameter</span><span class="p">))</span>

        <span class="c1"># Creating a new node with the new name and deleting the previous one</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">old_node_name</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">old_node_name</span><span class="p">]</span>

        <span class="c1"># Setting the same links as the original node</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links_to_copy</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">new_node_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&gt;&quot;</span>
                                  <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span>
                <span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;-&gt;&quot;</span>
                                  <span class="o">+</span> <span class="n">new_node_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Updating the pipeline</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">update_nodes_and_plugs_activation</span><span class="p">()</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;update_node_name&quot;</span><span class="p">,</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">new_node_name</span><span class="p">],</span>
                         <span class="n">new_node_name</span><span class="p">,</span> <span class="n">old_node_name</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;Node name &quot;</span><span class="si">{0}</span><span class="s1">&quot; has been changed to &quot;</span><span class="si">{1}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">old_node_name</span><span class="p">,</span> <span class="n">new_node_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="PipelineEditor.update_plug_value"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.update_plug_value">[docs]</a>    <span class="k">def</span> <span class="nf">update_plug_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">new_value</span><span class="p">,</span> <span class="n">plug_name</span><span class="p">,</span> <span class="n">value_type</span><span class="p">,</span>
                          <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a plug value.</span>

<span class="sd">        :param node_name: name of the node (str)</span>
<span class="sd">        :param new_value: new value to set to the plug</span>
<span class="sd">        :param plug_name: name of the plug to change (str)</span>
<span class="sd">        :param value_type: type of the new value</span>
<span class="sd">        :param from_undo: boolean, True if the action has been made using an</span>
<span class="sd">        undo</span>
<span class="sd">        :param from_redo: boolean, True if the action has been made using a</span>
<span class="sd">        redo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_plug_value</span><span class="p">(</span>
            <span class="n">plug_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span><span class="o">.</span><span class="n">set_plug_value</span><span class="p">(</span>
            <span class="n">plug_name</span><span class="p">,</span> <span class="n">value_type</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;update_plug_value&quot;</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span>
                         <span class="n">plug_name</span><span class="p">,</span> <span class="n">value_type</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s1">&#39;Plug &quot;</span><span class="si">{0}</span><span class="s1">&quot; of node &quot;</span><span class="si">{1}</span><span class="s1">&quot; has been changed to &quot;</span><span class="si">{2}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">plug_name</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">new_value</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_export_plug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_parameter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">weak_link</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">temp_plug_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export a plug to a pipeline global input or output.</span>

<span class="sd">        :param pipeline_parameter: name of the pipeline input/output</span>
<span class="sd">        :param optional: True if the plug is optional</span>
<span class="sd">        :param weak_link: True if the link is weak</span>
<span class="sd">        :param from_undo: True if this method is called from an undo action</span>
<span class="sd">        :param from_redo: True if this method is called from a redo action</span>
<span class="sd">        :param temp_plug_name: tuple containing (the name of the node, the</span>
<span class="sd">           name of the plug) to export</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Bug: the first parameter (here pipeline_parameter) cannot be None</span>
        <span class="c1"># even if we write pipeline_parameter=None in the line above,</span>
        <span class="c1"># it will be False...</span>

        <span class="k">if</span> <span class="n">temp_plug_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PlugEdit</span><span class="p">()</span>
            <span class="n">dial</span><span class="o">.</span><span class="n">name_line</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">dial</span><span class="o">.</span><span class="n">optional</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_temp_plug</span><span class="o">.</span><span class="n">optional</span><span class="p">)</span>
            <span class="n">temp_plug_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temp_plug_name</span>

            <span class="n">res</span> <span class="o">=</span> <span class="n">dial</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline_parameter</span><span class="p">:</span>
                <span class="n">pipeline_parameter</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dial</span><span class="o">.</span><span class="n">name_line</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">optional</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">optional</span> <span class="o">=</span> <span class="n">dial</span><span class="o">.</span><span class="n">optional</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">weak_link</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">weak_link</span> <span class="o">=</span> <span class="n">dial</span><span class="o">.</span><span class="n">weak</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">export_parameter</span><span class="p">(</span>
                    <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">pipeline_parameter</span><span class="o">=</span><span class="n">pipeline_parameter</span><span class="p">,</span>
                    <span class="n">is_optional</span><span class="o">=</span><span class="n">optional</span><span class="p">,</span>
                    <span class="n">weak_link</span><span class="o">=</span><span class="n">weak_link</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot export </span><span class="si">{0}</span><span class="s2">.</span><span class="si">{1}</span><span class="s2"> plug&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                          <span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="sd">&#39;&#39;&#39;self.scene.pipeline.export_parameter(</span>
<span class="sd">                temp_plug_name[0], temp_plug_name[1],</span>
<span class="sd">                pipeline_parameter=pipeline_parameter,</span>
<span class="sd">                is_optional=optional,</span>
<span class="sd">                weak_link=weak_link)&#39;&#39;&#39;</span>  <span class="c1"># Uncomment to generate the error</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;export_plug&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="n">pipeline_parameter</span><span class="p">),</span>
                         <span class="n">pipeline_parameter</span><span class="p">,</span> <span class="n">optional</span><span class="p">,</span> <span class="n">weak_link</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s2">&quot;Plug </span><span class="si">{0}</span><span class="s2"> has been exported.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<div class="viewcode-block" id="PipelineEditor.export_node_plugs"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.export_node_plugs">[docs]</a>    <span class="k">def</span> <span class="nf">export_node_plugs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">optional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports all the plugs of a node</span>

<span class="sd">        :param node_name: node name</span>
<span class="sd">        :param inputs: True if the inputs have to be exported</span>
<span class="sd">        :param outputs: True if the outputs have to be exported</span>
<span class="sd">        :param optional: True if the optional plugs have to be exported</span>
<span class="sd">        :param from_undo: True if this method is called from an undo action</span>
<span class="sd">        :param from_redo: True if this method is called from a redo action</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>

        <span class="n">parameter_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">parameter_name</span><span class="p">,</span> <span class="n">plug</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">plugs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">parameter_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;nodes_activation&quot;</span><span class="p">,</span> <span class="s2">&quot;selection_changed&quot;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(((</span><span class="n">node_name</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">do_not_export</span> <span class="ow">and</span>
                 <span class="p">((</span><span class="n">outputs</span> <span class="ow">and</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_to</span><span class="p">)</span> <span class="ow">or</span>
                  <span class="p">(</span><span class="n">inputs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">output</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_from</span><span class="p">))</span> <span class="ow">and</span>
                 <span class="p">(</span><span class="n">optional</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span><span class="o">.</span><span class="n">optional</span><span class="p">))):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pipeline</span><span class="o">.</span><span class="n">export_parameter</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">)</span>
                    <span class="n">parameter_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parameter_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cannot export </span><span class="si">{0}</span><span class="s2">.</span><span class="si">{1}</span><span class="s2"> plug&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">,</span>
                                                              <span class="n">parameter_name</span><span class="p">))</span>

        <span class="c1"># For history</span>
        <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;export_plugs&quot;</span><span class="p">,</span> <span class="n">parameter_list</span><span class="p">,</span> <span class="n">node_name</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
            <span class="s2">&quot;Plugs </span><span class="si">{0}</span><span class="s2"> have been exported.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parameter_list</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_remove_plug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_temp_plug_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_undo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">from_redo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">from_export_plugs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a plug</span>

<span class="sd">        :param _temp_plug_name: tuple containing (the name of the node,</span>
<span class="sd">           the name of the plug) to remove</span>
<span class="sd">        :param from_undo: True if this method is called from an undo action</span>
<span class="sd">        :param from_redo: True if this method is called from a redo action</span>
<span class="sd">        :param from_export_plugs: True if this method is called from a</span>
<span class="sd">           &quot;from_export_plugs&quot; undo or redo action</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_temp_plug_name</span><span class="p">:</span>
            <span class="n">_temp_plug_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_temp_plug_name</span>

        <span class="k">if</span> <span class="n">_temp_plug_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;inputs&#39;</span><span class="p">,</span> <span class="s1">&#39;outputs&#39;</span><span class="p">):</span>
            <span class="n">plug_name</span> <span class="o">=</span> <span class="n">_temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">plug</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">pipeline_node</span><span class="o">.</span><span class="n">plugs</span><span class="p">[</span><span class="n">plug_name</span><span class="p">]</span>
            <span class="n">optional</span> <span class="o">=</span> <span class="n">plug</span><span class="o">.</span><span class="n">optional</span>
            <span class="c1"># contains the plugs that are connected to the input or output plug</span>
            <span class="n">new_temp_plugs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_to</span><span class="p">:</span>
                <span class="n">temp_plug</span> <span class="o">=</span> <span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">new_temp_plugs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_plug</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">plug</span><span class="o">.</span><span class="n">links_from</span><span class="p">:</span>
                <span class="n">temp_plug</span> <span class="o">=</span> <span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">new_temp_plugs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_plug</span><span class="p">)</span>

            <span class="c1"># To avoid the &quot;_items&quot; bug: setting the has_items attribute</span>
            <span class="c1"># of the trait&#39;s handler to False</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
            <span class="n">source_trait</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get_trait</span><span class="p">(</span><span class="n">plug_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">source_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
                <span class="n">source_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">has_items</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span><span class="n">_temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

            <span class="c1"># if not from_undo and not from_redo:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">from_export_plugs</span><span class="p">:</span>
                <span class="c1"># For history</span>
                <span class="n">history_maker</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;remove_plug&quot;</span><span class="p">,</span> <span class="n">_temp_plug_name</span><span class="p">,</span>
                                 <span class="n">new_temp_plugs</span><span class="p">,</span> <span class="n">optional</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">update_history</span><span class="p">(</span><span class="n">history_maker</span><span class="p">,</span> <span class="n">from_undo</span><span class="p">,</span> <span class="n">from_redo</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span>
                    <span class="s2">&quot;Plug </span><span class="si">{0}</span><span class="s2"> has been removed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_temp_plug_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<div class="viewcode-block" id="PipelineEditor.check_modifications"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.check_modifications">[docs]</a>    <span class="k">def</span> <span class="nf">check_modifications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the nodes of the pipeline have been modified</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># List to store the removed links</span>
        <span class="n">removed_links</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Only if the node is a pipeline node ?</span>
            <span class="k">if</span> <span class="n">node_name</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">PipelineNode</span><span class="p">):</span>
                <span class="n">sub_pipeline_process</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">process</span>
                <span class="n">current_process_id</span> <span class="o">=</span> <span class="n">sub_pipeline_process</span><span class="o">.</span><span class="n">id</span>

                <span class="c1"># Reading the process configuration file</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                       <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                            <span class="n">dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span>
                                            <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

                    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
                        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">sub_pipeline_name</span> <span class="o">=</span> <span class="n">sub_pipeline_process</span><span class="o">.</span><span class="n">name</span>

                <span class="c1"># get_path returns a list that is the package path</span>
                <span class="c1"># to the sub_pipeline file</span>
                <span class="n">sub_pipeline_list</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="n">sub_pipeline_name</span><span class="p">,</span>
                                             <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;Packages&#39;</span><span class="p">])</span>
                <span class="n">sub_pipeline_name</span> <span class="o">=</span> <span class="n">sub_pipeline_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                <span class="c1"># Finding the real sub-pipeline filename</span>
                <span class="n">sub_pipeline_filename</span> <span class="o">=</span> <span class="n">find_filename</span><span class="p">(</span>
                    <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;Paths&#39;</span><span class="p">],</span> <span class="n">sub_pipeline_list</span><span class="p">,</span> <span class="n">sub_pipeline_name</span><span class="p">)</span>

                <span class="n">saved_process</span> <span class="o">=</span> <span class="n">get_process_instance</span><span class="p">(</span><span class="n">sub_pipeline_filename</span><span class="p">)</span>

                <span class="n">current_inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sub_pipeline_process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">current_outputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="n">sub_pipeline_process</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">saved_inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">saved_process</span><span class="o">.</span><span class="n">get_inputs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">saved_outputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">saved_process</span><span class="o">.</span><span class="n">get_outputs</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                <span class="n">new_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">saved_inputs</span>
                              <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_inputs</span><span class="p">]</span>
                <span class="n">new_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">saved_outputs</span>
                               <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_outputs</span><span class="p">]</span>
                <span class="n">removed_inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">current_inputs</span>
                                  <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">saved_inputs</span><span class="p">]</span>
                <span class="n">removed_outputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">current_outputs</span>
                                   <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">saved_outputs</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">new_inputs</span> <span class="ow">or</span> <span class="n">new_outputs</span> <span class="ow">or</span> <span class="n">removed_inputs</span> <span class="ow">or</span> \
                        <span class="n">removed_outputs</span><span class="p">:</span>

                    <span class="c1"># Checking the links of the node</span>
                    <span class="n">link_to_del</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">link</span><span class="p">,</span> <span class="n">glink</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">glinks</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span> <span class="ow">or</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">glink</span><span class="p">)</span>
                            <span class="n">link_to_del</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">link</span><span class="p">,</span> <span class="n">glink</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">link</span><span class="p">,</span> <span class="n">glink</span> <span class="ow">in</span> <span class="n">link_to_del</span><span class="p">:</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">glinks</span><span class="p">[</span><span class="n">link</span><span class="p">]</span>

                    <span class="c1"># Creating a new node</span>
                    <span class="n">new_node</span> <span class="o">=</span> <span class="n">saved_process</span><span class="o">.</span><span class="n">pipeline_node</span>
                    <span class="n">new_node</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">node_name</span>
                    <span class="n">new_node</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">pipeline</span>
                    <span class="n">saved_process</span><span class="o">.</span><span class="n">parent_pipeline</span> <span class="o">=</span> <span class="n">weak_proxy</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span>
                    <span class="n">pipeline</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_node</span>

                    <span class="c1"># Creating a new graphical node</span>
                    <span class="n">gnode</span> <span class="o">=</span> <span class="n">NodeGWidget</span><span class="p">(</span>
                        <span class="n">node_name</span><span class="p">,</span> <span class="n">new_node</span><span class="o">.</span><span class="n">plugs</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span>
                        <span class="n">sub_pipeline</span><span class="o">=</span><span class="n">saved_process</span><span class="p">,</span> <span class="n">process</span><span class="o">=</span><span class="n">saved_process</span><span class="p">,</span>
                        <span class="n">colored_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">colored_parameters</span><span class="p">,</span>
                        <span class="n">logical_view</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">logical_view</span><span class="p">,</span>
                        <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>

                    <span class="c1"># Setting the new node to the same position as the</span>
                    <span class="c1"># previous one</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
                    <span class="n">gnode</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

                    <span class="c1"># Removing the old node</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">gnodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">])</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">gnodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span>

                    <span class="c1"># Adding the new node to the scene</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">gnodes</span><span class="p">[</span><span class="n">node_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gnode</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">gnode</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">link</span><span class="p">,</span> <span class="n">glink</span> <span class="ow">in</span> <span class="n">link_to_del</span><span class="p">:</span>
                        <span class="n">source</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">dest</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inputs&#39;</span><span class="p">:</span>
                            <span class="n">link_plug</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">link_plug</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;outputs&#39;</span><span class="p">:</span>
                            <span class="n">link_plug</span> <span class="o">=</span> <span class="n">dest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">dest</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">link_plug</span><span class="p">)</span>

                        <span class="c1"># Writing a string to represent the link</span>
                        <span class="n">source_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
                        <span class="n">dest_parameters</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
                        <span class="n">pipeline_link</span> <span class="o">=</span> <span class="s2">&quot;-&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">source_parameters</span><span class="p">,</span>
                                                   <span class="n">dest_parameters</span><span class="p">))</span>

                        <span class="c1"># Checking if a connected plug has been deleting</span>
                        <span class="k">if</span> <span class="n">dest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span> <span class="ow">and</span> <span class="n">dest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">removed_inputs</span><span class="p">:</span>
                            <span class="n">removed_links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline_link</span><span class="p">)</span>
                            <span class="k">continue</span>

                        <span class="k">if</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">node_name</span> <span class="ow">and</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> \
                                <span class="n">removed_outputs</span><span class="p">:</span>
                            <span class="n">removed_links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pipeline_link</span><span class="p">)</span>
                            <span class="k">continue</span>

                        <span class="c1"># Adding the link</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">pipeline_link</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_link</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">update_pipeline</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">removed_links</span><span class="p">:</span>
            <span class="n">dialog_text</span> <span class="o">=</span> <span class="s1">&#39;Pipeline </span><span class="si">{0}</span><span class="s1"> has been updated.</span><span class="se">\n</span><span class="s1">&#39;</span> \
                          <span class="s1">&#39;Removed links:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">removed_link</span> <span class="ow">in</span> <span class="n">removed_links</span><span class="p">:</span>
                <span class="n">dialog_text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">removed_link</span><span class="p">)</span>

            <span class="n">pop_up</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">dialog_text</span><span class="p">)</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning: links have been removed&quot;</span><span class="p">)</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span>
                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="n">pop_up</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="PipelineEditor.save_pipeline"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.save_pipeline">[docs]</a>    <span class="k">def</span> <span class="nf">save_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves the pipeline</span>

<span class="sd">        :return: the pipeline file name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">pipeline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipeline</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                                  <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                                  <span class="s1">&#39;User_processes&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;__init__.py&#39;</span><span class="p">))):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">folder</span><span class="p">,</span> <span class="s1">&#39;__init__.py&#39;</span><span class="p">)),</span> <span class="s1">&#39;w&#39;</span><span class="p">):</span>
                    <span class="k">pass</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Save the pipeline&#39;</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span>
                <span class="s1">&#39;Compatible files (*.py);; All (*)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>  <span class="c1"># save widget was cancelled by the user</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># which means no extension</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s1">&#39;.py&#39;</span>

            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.py&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;The pipeline will be saved with a&#39;</span> <span class="o">+</span>
                            <span class="s1">&#39; &quot;.py&quot; extension instead of </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">posdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">y</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span>
                            <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pos</span><span class="p">)])</span>
            <span class="n">dimdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">key</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span>
                            <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">dim</span><span class="p">)])</span>  <span class="c1"># add by Irmage OM</span>

            <span class="n">pipeline</span><span class="o">.</span><span class="n">node_dimension</span> <span class="o">=</span> <span class="n">dimdict</span>  <span class="c1"># add by Irmage OM</span>

            <span class="n">old_pos</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span> <span class="o">=</span> <span class="n">posdict</span>
            <span class="c1"># pipeline_tools.save_pipeline(pipeline, filename)</span>
            <span class="n">save_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_filename</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pipeline</span><span class="o">.</span><span class="n">node_position</span> <span class="o">=</span> <span class="n">old_pos</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_saved</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">filename</span></div>

<div class="viewcode-block" id="PipelineEditor.get_current_filename"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.PipelineEditor.get_current_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the relative path the pipeline was last saved to.</span>
<span class="sd">        Empty if never saved.</span>

<span class="sd">        :return: the current pipeline file name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_pipeline_filename&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_filename</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span></div></div>


<div class="viewcode-block" id="save_pipeline"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.save_pipeline">[docs]</a><span class="k">def</span> <span class="nf">save_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Save the pipeline either in XML or .py source file&quot;&quot;&quot;</span>
    <span class="n">formats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;.py&#39;</span><span class="p">:</span> <span class="n">save_py_pipeline</span><span class="p">,</span>
               <span class="s1">&#39;.xml&#39;</span><span class="p">:</span> <span class="n">save_xml_pipeline</span><span class="p">}</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="n">writer</span> <span class="ow">in</span> <span class="n">six</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(</span><span class="n">formats</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ext</span><span class="p">):</span>
            <span class="n">writer</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">saved</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">saved</span><span class="p">:</span>
        <span class="c1"># fallback to .py</span>
        <span class="n">save_py_pipeline</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_path"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.get_path">[docs]</a><span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">,</span> <span class="n">prev_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the package path to the selected sub-pipeline.</span>

<span class="sd">    :param name: name of the sub-pipeline</span>
<span class="sd">    :param dictionary: package tree (read from process_config.yml)</span>
<span class="sd">    :param prev_paths: paths of the last call of this function</span>
<span class="sd">    :return: the package path of the sub-pipeline if it is found, else None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">prev_paths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prev_paths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># new_paths is a list containing the packages to the desired module</span>
    <span class="n">new_paths</span> <span class="o">=</span> <span class="n">prev_paths</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="c1"># If the value is a string, this means</span>
        <span class="c1"># that this is a &quot;leaf&quot; of the tree</span>
        <span class="c1"># so the key is a module name.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">new_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_paths</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="c1"># Else, this means that the value is still a dictionary,</span>
        <span class="c1"># we are still in the tree</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">final_res</span> <span class="o">=</span> <span class="n">get_path</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">new_paths</span><span class="p">)</span>
            <span class="c1"># final_res is None if the module name has not</span>
            <span class="c1"># been found in the tree</span>
            <span class="k">if</span> <span class="n">final_res</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">final_res</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_paths</span> <span class="o">=</span> <span class="n">prev_paths</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>


<div class="viewcode-block" id="find_filename"><a class="viewcode-back" href="../../../populse_mia.pipeline_manager.html#populse_mia.pipeline_manager.pipeline_editor.find_filename">[docs]</a><span class="k">def</span> <span class="nf">find_filename</span><span class="p">(</span><span class="n">paths_list</span><span class="p">,</span> <span class="n">packages_list</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the corresponding file name in the paths list of process_config.yml.</span>

<span class="sd">    :param paths_list: list of all the paths contained in process_config.yml</span>
<span class="sd">    :param packages_list: packages path</span>
<span class="sd">    :param file_name: name of the sub-pipeline</span>
<span class="sd">    :return: name of the corresponding file if it is found, else None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths_list</span><span class="p">:</span>
            <span class="n">new_path</span> <span class="o">=</span> <span class="n">path</span>
            <span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="n">packages_list</span><span class="p">:</span>
                <span class="n">new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">package</span><span class="p">)</span>

            <span class="c1"># Making sure that the filename is found (has somme issues</span>
            <span class="c1"># with case sensitivity)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">new_path</span><span class="p">):</span>
                <span class="n">new_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">filename</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">new_file</span></div>


</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, populse.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>