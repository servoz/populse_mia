
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>populse_mia.user_interface.pipeline_manager.process_library &#8212; populse_mia 1.2.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../../index.html">
          <span>populse_mia 1.2.1 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.user_interface.pipeline_manager.process_library</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.user_interface.pipeline_manager.process_library</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*- #</span>
<span class="sd">&quot;&quot;&quot;Module that contains class and methods to process the different libraries of</span>
<span class="sd">the project.</span>

<span class="sd">:Contains:</span>
<span class="sd">    :Class:</span>
<span class="sd">        - DictionaryTreeModel</span>
<span class="sd">        - InstallProcesses</span>
<span class="sd">        - Node</span>
<span class="sd">        - PackageLibrary</span>
<span class="sd">        - PackageLibraryDialog</span>
<span class="sd">        - ProcessLibrary</span>
<span class="sd">        - ProcessHelp</span>
<span class="sd">        - ProcessLibraryWidget</span>

<span class="sd">    :Functions:</span>
<span class="sd">        - import_file</span>
<span class="sd">        - node_structure_from_dict</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">pkgutil</span>
<span class="kn">from</span> <span class="nn">zipfile</span> <span class="k">import</span> <span class="n">ZipFile</span><span class="p">,</span> <span class="n">is_zipfile</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">distutils.dir_util</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="c1"># PyQt5 import</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtCore</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="k">import</span> <span class="n">QSortFilterProxyModel</span>

<span class="c1"># PyQt / PySide import, via soma</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui</span> <span class="k">import</span> <span class="n">qt_backend</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend.QtCore</span> <span class="k">import</span> <span class="p">(</span><span class="n">Qt</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span>
    <span class="n">QAbstractItemModel</span><span class="p">,</span> <span class="n">QByteArray</span><span class="p">,</span> <span class="n">QMimeData</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">soma.qt_gui.qt_backend.Qt</span> <span class="k">import</span> <span class="p">(</span><span class="n">QWidget</span><span class="p">,</span> <span class="n">QTreeWidget</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span>
    <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QTreeWidgetItem</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QSplitter</span><span class="p">,</span> <span class="n">QTreeView</span><span class="p">,</span> <span class="n">QFileDialog</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">)</span>

<span class="c1"># Populse_MIA import</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties</span> <span class="k">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties</span> <span class="k">import</span> <span class="n">verCmp</span>

<span class="c1"># capsul import</span>
<span class="kn">from</span> <span class="nn">capsul.api</span> <span class="k">import</span> <span class="n">get_process_instance</span>


<div class="viewcode-block" id="DictionaryTreeModel"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel">[docs]</a><span class="k">class</span> <span class="nc">DictionaryTreeModel</span><span class="p">(</span><span class="n">QAbstractItemModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Data model providing a tree of an arbitrary dictionary.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - columnCount: return always 1</span>
<span class="sd">        - data: return the data requested by the view</span>
<span class="sd">        - flags: everything is enabled and selectable, only the leaves can be</span>
<span class="sd">        dragged.</span>
<span class="sd">        - getNode: return a Node() from given index</span>
<span class="sd">        - headerData: return the name of the requested column</span>
<span class="sd">        - index: return an index from given row, column and parent</span>
<span class="sd">        - insertRows: insert rows from starting position and number given by</span>
<span class="sd">        rows</span>
<span class="sd">        - mimeData: used when the widget is dragged by the user</span>
<span class="sd">        - mimeTypes: return a constant</span>
<span class="sd">        - parent: return the parent from given index</span>
<span class="sd">        - removeRows: remove the rows from position to position+rows</span>
<span class="sd">        - rowCount: the number of rows is the number of children</span>
<span class="sd">        - setData: method called when the user changes data</span>
<span class="sd">        - to_dict: return the root node as a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DictionaryTreeModel.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of the DictionaryTreeModel class.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DictionaryTreeModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span> <span class="o">=</span> <span class="n">root</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.columnCount"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.columnCount">[docs]</a>    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of columns is always 1.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.data"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the data requested by the view.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span> <span class="ow">or</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.flags"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.flags">[docs]</a>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Everything is enabled and selectable. Only the leaves can be</span>
<span class="sd">        dragged.&quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsDragEnabled</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.getNode"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.getNode">[docs]</a>    <span class="k">def</span> <span class="nf">getNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a Node() from given index.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">node</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.headerData"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.headerData">[docs]</a>    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the name of the requested column.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Packages&quot;</span>
            <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Value&quot;</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.index"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an index from given row, column and parent.&quot;&quot;&quot;</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">childItem</span> <span class="o">=</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">childItem</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">createIndex</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">childItem</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QModelIndex</span><span class="p">()</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.insertRows"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.insertRows">[docs]</a>    <span class="k">def</span> <span class="nf">insertRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">QModelIndex</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Insert rows from starting position and number given by rows.&quot;&quot;&quot;</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginInsertRows</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">childCount</span> <span class="o">=</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span>
            <span class="n">childNode</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s2">&quot;untitled&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">childCount</span><span class="p">))</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">insertChild</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">childNode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">endInsertRows</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">success</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.mimeData"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.mimeData">[docs]</a>    <span class="k">def</span> <span class="nf">mimeData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used when the widget is dragged by the user.</span>

<span class="sd">        :param idxs: mouse event</span>
<span class="sd">        :return: QMimeData object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mimedata</span> <span class="o">=</span> <span class="n">QMimeData</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">column</span><span class="p">())</span>
                <span class="n">mimedata</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="s1">&#39;component/name&#39;</span><span class="p">,</span> <span class="n">QByteArray</span><span class="p">(</span><span class="n">txt</span><span class="o">.</span><span class="n">encode</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">mimedata</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.mimeTypes"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.mimeTypes">[docs]</a>    <span class="k">def</span> <span class="nf">mimeTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a constant.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;component/name&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.parent"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.parent">[docs]</a>    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the parent from given index.</span>

<span class="sd">        :param index: index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parentNode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QModelIndex</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">createIndex</span><span class="p">(</span><span class="n">parentNode</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">parentNode</span><span class="p">)</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.removeRows"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.removeRows">[docs]</a>    <span class="k">def</span> <span class="nf">removeRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">QModelIndex</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;Remove the rows from position to position+rows.</span>

<span class="sd">        :param position: the position of the node</span>
<span class="sd">        :param rows: the row of the tnode</span>
<span class="sd">        :param parent: the parent node</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parentNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginRemoveRows</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">success</span> <span class="o">=</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">removeChild</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">endRemoveRows</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">success</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.rowCount"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.rowCount">[docs]</a>    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The number of rows is the number of children.</span>

<span class="sd">        :param parent: the parent of the node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">parentNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parentNode</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">parentNode</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.setData"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.setData">[docs]</a>    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method gets called when the user changes data.</span>

<span class="sd">        :param index: index</span>
<span class="sd">        :param value: value</span>
<span class="sd">        :param role: Qt role</span>
<span class="sd">        :return: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
                <span class="n">node</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="DictionaryTreeModel.to_dict"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.DictionaryTreeModel.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the root node as a dictionary.</span>

<span class="sd">        :return: dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rootNode</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="InstallProcesses"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.InstallProcesses">[docs]</a><span class="k">class</span> <span class="nc">InstallProcesses</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A widget that allows to browse a Python package or a zip file to install</span>
<span class="sd">    the processes that it is containing.</span>

<span class="sd">    :param main_window: current main window</span>
<span class="sd">    :param folder: boolean, True if folder, False if zip</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - get_filename: opens a file dialog to get the folder or zip file to</span>
<span class="sd">        install</span>
<span class="sd">        - install: installs the selected file/folder on Populse_MIA</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">process_installed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

<div class="viewcode-block" id="InstallProcesses.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.InstallProcesses.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_window</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the InstallProcesses class.</span>

<span class="sd">        :param main_window: current main window</span>
<span class="sd">        :param folder: boolean, True if folder, False if zip</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">InstallProcesses</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">main_window</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Install processes&#39;</span><span class="p">)</span>

        <span class="n">v_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">v_layout</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">label_text</span> <span class="o">=</span> <span class="s1">&#39;Choose zip file containing Python packages&#39;</span>

        <span class="k">elif</span> <span class="n">folder</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">label_text</span> <span class="o">=</span> <span class="s1">&#39;Choose folder containing Python packages&#39;</span>

        <span class="n">v_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="n">label_text</span><span class="p">))</span>

        <span class="n">edit_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">v_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">edit_layout</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="n">edit_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Browse&#39;</span><span class="p">)</span>
        <span class="n">edit_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browser_button</span><span class="p">)</span>

        <span class="n">bottom_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">v_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">bottom_layout</span><span class="p">)</span>

        <span class="n">install_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Install package&#39;</span><span class="p">)</span>
        <span class="n">bottom_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">install_button</span><span class="p">)</span>

        <span class="n">quit_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Quit&#39;</span><span class="p">)</span>
        <span class="n">bottom_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">quit_button</span><span class="p">)</span>

        <span class="n">install_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">install</span><span class="p">)</span>
        <span class="n">quit_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">browser_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">))</span></div>

<div class="viewcode-block" id="InstallProcesses.get_filename"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.InstallProcesses.get_filename">[docs]</a>    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open a file dialog to get the folder or zip file to install.</span>

<span class="sd">        :param folder: True if the dialog installs from folder, False if</span>
<span class="sd">        from zip file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Select a directory&#39;</span><span class="p">,</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
                <span class="n">options</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">folder</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
                <span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Select a zip file&#39;</span><span class="p">,</span>
                <span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span>
                <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Compatible files (*.zip)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">filename</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="InstallProcesses.install"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.InstallProcesses.install">[docs]</a>    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Install a package from a zip file or a folder.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">add_package</span><span class="p">(</span><span class="n">proc_dic</span><span class="p">,</span> <span class="n">module_name</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Add a package and its modules to the package tree.</span>

<span class="sd">            :param proc_dic: the process tree-dictionary</span>
<span class="sd">            :param module_name: name of the module</span>
<span class="sd">            :return: proc_dic: the modified process tree-dictionary</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">module_name</span><span class="p">:</span>

                <span class="c1"># Reloading the package</span>
                <span class="k">if</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">er</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">((</span><span class="s1">&#39;During the installation of </span><span class="si">{0}</span><span class="s1">, &#39;</span>
                                 <span class="s1">&#39;the folllowing exception was raised:&#39;</span>
                                 <span class="s1">&#39;</span><span class="se">\n</span><span class="si">{1}</span><span class="s1">: </span><span class="si">{2}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">This exception maybe &#39;</span>
                                 <span class="s1">&#39;prevented the installation ...&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">module_name</span><span class="p">,</span> <span class="n">er</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">er</span><span class="p">))</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                        <span class="s1">&#39;The </span><span class="si">{0}</span><span class="s1"> brick may not been installed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">module_name</span><span class="p">))</span>

                <span class="n">pkg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

                <span class="c1"># Checking if there are subpackages</span>
                <span class="k">for</span> <span class="n">importer</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">ispkg</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">iter_modules</span><span class="p">(</span>
                        <span class="n">pkg</span><span class="o">.</span><span class="n">__path__</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ispkg</span><span class="p">:</span>
                        <span class="n">add_package</span><span class="p">(</span><span class="n">proc_dic</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">module_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">modname</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>
                    <span class="c1"># Checking each class of in the package</span>
                    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Installing </span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> ...&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">module_name</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                            <span class="n">get_process_instance</span><span class="p">(</span>
                                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
                            <span class="c1"># TODO: WHICH TYPE OF EXCEPTION?</span>
                            <span class="c1"># pass</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Updating the tree&#39;s dictionnary</span>
                            <span class="n">path_list</span> <span class="o">=</span> <span class="n">module_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                            <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                            <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">proc_dic</span>

                            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">:</span>

                                <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

                                <span class="k">else</span><span class="p">:</span>

                                    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                                        <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;process_enabled&#39;</span>

                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                                        <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

                <span class="k">return</span> <span class="n">proc_dic</span>

        <span class="k">def</span> <span class="nf">change_pattern_in_folder</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">old_pattern</span><span class="p">,</span> <span class="n">new_pattern</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Changing all &quot;old_pattern&quot; pattern to &quot;new_pattern&quot; in the</span>
<span class="sd">            &quot;path&quot; folder.</span>

<span class="sd">            :param path: path of the extracted or copied processes</span>
<span class="sd">            :param old_pattern: old pattern</span>
<span class="sd">            :param new_pattern: new pattern</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">dname</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>

                <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="c1"># Modifying only .py files (pipelines are saved with</span>
                    <span class="c1"># this extension)</span>

                    <span class="k">if</span> <span class="n">fname</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;py&#39;</span><span class="p">:</span>
                        <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dname</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_pattern</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">new_pattern</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The specified file cannot be found&quot;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;.zip&quot;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The specified file has to be a .zip file&quot;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                            <span class="s1">&#39;processes&#39;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                 <span class="s1">&#39;processes&#39;</span><span class="p">)))</span>

            <span class="c1"># Process config update</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                               <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">)):</span>
                <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                  <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                   <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                        <span class="n">process_dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span>
                                                <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">process_dic</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

                <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">process_dic</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">process_dic</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">process_dic</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Copying the original process tree</span>
            <span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span>
            <span class="n">process_dic_orig</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">process_dic</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">packages</span> <span class="o">=</span> <span class="n">process_dic</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">packages</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">packages</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="n">process_dic</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Saving all the install packages names and checking if</span>
            <span class="c1"># the MIA_processes are updated</span>
            <span class="n">package_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mia_processes_not_found</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># packages_already: packages already installed in populse_</span>
            <span class="c1"># mia (populse_mia/processes)</span>
            <span class="n">packages_already</span> <span class="o">=</span> <span class="p">[</span><span class="n">dire</span> <span class="k">for</span> <span class="n">dire</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">))</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span> <span class="n">dire</span><span class="p">))]</span>

            <span class="k">if</span> <span class="n">is_zipfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="c1"># Extraction of the zipped content</span>
                <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                    <span class="n">packages_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span>
                                     <span class="n">zip_ref</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                                     <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span> <span class="ow">is</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span>
                        <span class="n">member</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>

            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span>
                    <span class="n">filename</span><span class="p">):</span>
                <span class="c1"># !!! careful: if filename is not a zip file,</span>
                <span class="c1"># filename must be a directory</span>
                <span class="c1"># that contains only the package(s) to install!!!</span>
                <span class="n">packages_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span>

            <span class="k">for</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">packages_name</span><span class="p">:</span>
                <span class="c1"># package_name: package(s) in the zip file or in folder</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">package_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">packages_already</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">package_name</span> <span class="o">==</span> <span class="s1">&#39;mia_processes&#39;</span><span class="p">):</span>
                    <span class="c1"># Copy MIA_processes in a temporary folder</span>
                    <span class="k">if</span> <span class="n">mia_processes_not_found</span><span class="p">:</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">package_name</span> <span class="o">==</span> <span class="s2">&quot;mia_processes&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                                 <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                                 <span class="s1">&#39;mia_processes&#39;</span><span class="p">))):</span>
                            <span class="n">mia_processes_not_found</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">tmp_folder4MIA</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
                            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                                         <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                                         <span class="s1">&#39;mia_processes&#39;</span><span class="p">),</span>
                                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_folder4MIA</span><span class="p">,</span>
                                                         <span class="s1">&#39;MIA_processes&#39;</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">is_zipfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

                        <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                            <span class="n">members_to_extract</span> <span class="o">=</span> <span class="p">[</span><span class="n">member</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span>
                                                  <span class="n">zip_ref</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                                                  <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                                    <span class="n">package_name</span><span class="p">)]</span>
                            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                             <span class="s1">&#39;processes&#39;</span><span class="p">),</span> <span class="n">members_to_extract</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                        <span class="n">distutils</span><span class="o">.</span><span class="n">dir_util</span><span class="o">.</span><span class="n">copy_tree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
                                                     <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                                         <span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                                         <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                                         <span class="n">package_name</span><span class="p">))</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">is_zipfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>

                        <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                            <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
                            <span class="n">members_to_extract</span> <span class="o">=</span> <span class="p">[</span><span class="n">member</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span>
                                                  <span class="n">zip_ref</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                                                  <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
                                    <span class="n">package_name</span><span class="p">)]</span>
                            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">members_to_extract</span><span class="p">)</span>
                            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">package_name</span><span class="p">),</span>
                                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                                     <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                                     <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">date</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
                                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                                     <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                                     <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">date</span><span class="p">))</span>

                    <span class="n">original_package_name</span> <span class="o">=</span> <span class="n">package_name</span>
                    <span class="n">package_name</span> <span class="o">=</span> <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">date</span>

                    <span class="c1"># Replacing the original package name pattern in</span>
                    <span class="c1"># all the extracted files by the package name</span>
                    <span class="c1"># with the date</span>
                    <span class="n">change_pattern_in_folder</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                     <span class="n">package_name</span><span class="p">),</span>
                        <span class="n">original_package_name</span><span class="p">,</span> <span class="n">package_name</span><span class="p">)</span>

                <span class="n">package_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
                <span class="c1"># package_names contains all the extracted packages</span>
                <span class="n">final_package_dic</span> <span class="o">=</span> <span class="n">add_package</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">package_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">))</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">)))</span>

            <span class="n">process_dic</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_package_dic</span>
            <span class="n">process_dic</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">paths</span>

            <span class="c1"># Idea: Should we encrypt the path ?</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span>
                      <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">process_dic</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">process_installed</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

            <span class="c1"># Cleaning the temporary folder</span>
            <span class="k">if</span> <span class="s1">&#39;tmp_folder4MIA&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmp_folder4MIA</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;temp_dir&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Don&#39;t know which kind of exception can be raised yet</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="se">\n</span><span class="s1">Installation aborted ... !&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>

            <span class="c1"># Resetting process_config.yml</span>
            <span class="k">if</span> <span class="n">process_dic_orig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">process_dic_orig</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                   <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span>
                      <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">process_dic_orig</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Deleting the extracted files</span>
            <span class="k">if</span> <span class="n">package_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">package_names</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">package_name</span> <span class="ow">in</span> <span class="n">package_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                     <span class="n">package_name</span><span class="p">)):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                     <span class="n">package_name</span><span class="p">))</span>

            <span class="c1"># If the error comes from a MIA_process update,</span>
            <span class="c1"># the old version is restored</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mia_processes_not_found</span><span class="p">:</span>
                <span class="n">distutils</span><span class="o">.</span><span class="n">dir_util</span><span class="o">.</span><span class="n">copy_tree</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_folder4MIA</span><span class="p">,</span> <span class="s1">&#39;mia_processes&#39;</span><span class="p">),</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;mia_processes&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="s1">&#39;tmp_folder4MIA&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmp_folder4MIA</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;temp_dir&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Installation completed&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;The package </span><span class="si">{0}</span><span class="s2"> has been correctly installed.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">package_name</span><span class="p">))</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="ProcessLibraryWidget"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget">[docs]</a><span class="k">class</span> <span class="nc">ProcessLibraryWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Widget that handles the available Capsul&#39;s processes in the software.</span>

<span class="sd">    :param main_window: current main window</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - load_config: read the config in process_config.yml and return it as</span>
<span class="sd">        a dictionary</span>
<span class="sd">        - load_packages: sets packages and paths to the widget and to the</span>
<span class="sd">        system paths</span>
<span class="sd">        - open_pkg_lib: opens the package library</span>
<span class="sd">        - save_config: saves the current config to process_config.yml</span>
<span class="sd">        - update_config: updates the config and loads the corresponding</span>
<span class="sd">        packages</span>
<span class="sd">        - update_process_library: updates the tree of the process library</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ProcessLibraryWidget.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_window</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the ProcessLibraryWidget.</span>

<span class="sd">        :param main_window: current main window</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ProcessLibraryWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Process Library&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_window</span> <span class="o">=</span> <span class="n">main_window</span>

        <span class="c1"># Process Config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_config</span><span class="p">()</span>

        <span class="c1"># Process Library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span> <span class="o">=</span> <span class="n">ProcessLibrary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">setDragDropMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">DragOnly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">setDragEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">SingleSelection</span><span class="p">)</span>

        <span class="c1"># # Push button to call the package library</span>
        <span class="c1"># push_button_pkg_lib = QPushButton()</span>
        <span class="c1"># push_button_pkg_lib.setText(&#39;Package library manager&#39;)</span>
        <span class="c1"># push_button_pkg_lib.clicked.connect(self.open_pkg_lib)</span>

        <span class="c1"># Test to see the inputs/outputs of a process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_test</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>

        <span class="c1"># Splitter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span> <span class="o">=</span> <span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="p">)</span>

        <span class="c1"># Layout</span>
        <span class="n">h_box</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="c1"># h_box.addWidget(push_button_pkg_lib)</span>
        <span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">h_box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span> <span class="o">=</span> <span class="n">PackageLibraryDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">main_window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">signal_save</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_process_library</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessLibraryWidget.load_config"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.load_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_config</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Read the config in process_config.yml and return it as a dictionary.</span>

<span class="sd">        :return: the config as a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;process_config.yml&#39;</span><span class="p">)):</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessLibraryWidget.load_packages"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.load_packages">[docs]</a>    <span class="k">def</span> <span class="nf">load_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set packages and paths to the widget and to the system paths.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">:</span>
            <span class="c1"># Adding the module path to the system path</span>
            <span class="c1"># sys.path.insert(0, os.path.abspath(path))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span></div>

<div class="viewcode-block" id="ProcessLibraryWidget.open_pkg_lib"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.open_pkg_lib">[docs]</a>    <span class="k">def</span> <span class="nf">open_pkg_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the package library.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pkg_library</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessLibraryWidget.save_config"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.save_config">[docs]</a>    <span class="k">def</span> <span class="nf">save_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the current config to process_config.yml.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> \
                <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessLibraryWidget.update_config"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.update_config">[docs]</a>    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the config and loads the corresponding packages.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_packages</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessLibraryWidget.update_process_library"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibraryWidget.update_process_library">[docs]</a>    <span class="k">def</span> <span class="nf">update_process_library</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the tree of the process library.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_library</span><span class="o">.</span><span class="n">load_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Node"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node">[docs]</a><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to handle a package children.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - _recurse_dict: add the name and value of the farthest child in the</span>
<span class="sd">        dictionary</span>
<span class="sd">        - addChild: add a child to the children list</span>
<span class="sd">        - attrs:</span>
<span class="sd">        - child: return a child from its index in the list</span>
<span class="sd">        - childCount: return the number of children</span>
<span class="sd">        - data: return the name or the value of the object</span>
<span class="sd">        - insertChild: insert a child to a specific position</span>
<span class="sd">        - log: return the logs</span>
<span class="sd">        - name: return the name of the object</span>
<span class="sd">        - parent: return the parent of the object</span>
<span class="sd">        - removeChild: remove a specific child</span>
<span class="sd">        - row: return the index of the object in its parent list of children</span>
<span class="sd">        - to_dict: return a dictionary of the children</span>
<span class="sd">        - to_list: return the list of children with their names and values</span>
<span class="sd">        - value: return the value of the object</span>
<span class="sd">        - setData: update the name or the value of the object</span>
<span class="sd">        - resource: return a None</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Node.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of the Node class.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define what should be printed by the class.</span>

<span class="sd">        :return: the logs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_recurse_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the name and value of the farthest child in the dictionary.</span>

<span class="sd">        :param d: dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">_recurse_dict</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="Node.addChild"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.addChild">[docs]</a>    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a child to the children list.</span>

<span class="sd">        :param child: child to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span></div>

<div class="viewcode-block" id="Node.attrs"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.attrs">[docs]</a>    <span class="k">def</span> <span class="nf">attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span>
        <span class="n">keyvalued</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
                    <span class="n">keyvalued</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">keyvalued</span></div>

<div class="viewcode-block" id="Node.child"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.child">[docs]</a>    <span class="k">def</span> <span class="nf">child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a child from its index in the list.</span>

<span class="sd">        :param row: index in the list of children</span>
<span class="sd">        :return: child</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">row</span><span class="p">]</span></div>

<div class="viewcode-block" id="Node.childCount"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.childCount">[docs]</a>    <span class="k">def</span> <span class="nf">childCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the number of children.</span>

<span class="sd">        :return: the length of the children list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span></div>

<div class="viewcode-block" id="Node.data"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the name or the value of the object.</span>

<span class="sd">        :param column: 0 for name, 1 for value</span>
<span class="sd">        :return: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="k">while</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;Root&#39;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">text</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">_parent</span>
            <span class="k">return</span> <span class="n">text</span>  <span class="c1"># self.name</span>

        <span class="k">elif</span> <span class="n">column</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Node.insertChild"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.insertChild">[docs]</a>    <span class="k">def</span> <span class="nf">insertChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Insert a child to a specific position.</span>

<span class="sd">        :param position: position</span>
<span class="sd">        :param child: child</span>
<span class="sd">        :return: boolean, True if the insertion was successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Node.log"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tabLevel</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the logs.</span>

<span class="sd">        :param tabLevel: Number of tabulation</span>
<span class="sd">        :return: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">tabLevel</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tabLevel</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;    &#39;</span>

        <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;|----&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="s1">&#39; = &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="n">child</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tabLevel</span><span class="p">)</span>

        <span class="n">tabLevel</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">output</span></div>

    <span class="k">def</span> <span class="nf">name</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Return the name of the object.</span>

<span class="sd">        :return: name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

        <span class="k">def</span> <span class="nf">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

    <span class="n">name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="o">**</span><span class="n">name</span><span class="p">())</span>

<div class="viewcode-block" id="Node.parent"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.parent">[docs]</a>    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the parent of the object.</span>

<span class="sd">        :return: parent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span></div>

<div class="viewcode-block" id="Node.removeChild"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.removeChild">[docs]</a>    <span class="k">def</span> <span class="nf">removeChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a specific child.</span>

<span class="sd">        :param position: position of the child</span>
<span class="sd">        :param child: child to remove</span>
<span class="sd">        :return: boolean, True if the child was removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">position</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Node.row"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.row">[docs]</a>    <span class="k">def</span> <span class="nf">row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the index of the object in its parent list of children.</span>

<span class="sd">        :return: index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Node.to_dict"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary of the children.</span>

<span class="sd">        :param d: dictionary</span>
<span class="sd">        :return: dictionary of children</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_recurse_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="Node.to_list"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.to_list">[docs]</a>    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the list of children with their names and values.</span>

<span class="sd">        :return: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span></div>

    <span class="k">def</span> <span class="nf">value</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Return the value of the object.</span>

<span class="sd">        :return: value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

        <span class="k">def</span> <span class="nf">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="o">**</span><span class="n">value</span><span class="p">())</span>

<div class="viewcode-block" id="Node.setData"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.setData">[docs]</a>    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the name or the value of the object.</span>

<span class="sd">        :param column: 0 for name, 1 for value</span>
<span class="sd">        :param value: new value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">is</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Node.resource"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.Node.resource">[docs]</a>    <span class="k">def</span> <span class="nf">resource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return None</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="PackageLibrary"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary">[docs]</a><span class="k">class</span> <span class="nc">PackageLibrary</span><span class="p">(</span><span class="n">QTreeWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tree that displays the user-added packages and their modules.</span>
<span class="sd">    The user can check or not each module/package.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - fill_item: fills the items of the tree recursively</span>
<span class="sd">        - generate_tree: generates the package tree</span>
<span class="sd">        - recursive_checks: checks/unchecks all child items</span>
<span class="sd">        - recursive_checks_from_child: checks/unchecks all parent items</span>
<span class="sd">        - set_module_view: sets if a module has to be enabled or disabled in</span>
<span class="sd">        the process library</span>
<span class="sd">        - update_checks: updates the checks of the tree from an item</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PackageLibrary.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_tree</span><span class="p">,</span> <span class="n">paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of the PackageLibrary widget.</span>

<span class="sd">        :param package_tree: representation of the packages as a tree-dictionary</span>
<span class="sd">        :param paths: list of paths to add to the system to import the packages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PackageLibrary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_checks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="n">package_tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="n">paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAlternatingRowColors</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHeaderLabel</span><span class="p">(</span><span class="s2">&quot;Packages&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibrary.fill_item"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.fill_item">[docs]</a>    <span class="k">def</span> <span class="nf">fill_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill the items of the tree recursively.</span>

<span class="sd">        :param item: current item to fill</span>
<span class="sd">        :param value: value of the item in the tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
                <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                <span class="n">item</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s1">&#39;process_enabled&#39;</span><span class="p">:</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks_from_child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="s1">&#39;process_disabled&#39;</span><span class="p">:</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
                <span class="n">item</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;[dict]&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;[list]&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

                <span class="n">child</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">()</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">item</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibrary.generate_tree"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.generate_tree">[docs]</a>    <span class="k">def</span> <span class="nf">generate_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate the package tree&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invisibleRootItem</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_checks</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibrary.recursive_checks"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.recursive_checks">[docs]</a>    <span class="k">def</span> <span class="nf">recursive_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check/uncheck all child items.</span>

<span class="sd">        :param parent: parent item</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_state</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_module_view</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">check_state</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">check_state</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>

<div class="viewcode-block" id="PackageLibrary.recursive_checks_from_child"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.recursive_checks_from_child">[docs]</a>    <span class="k">def</span> <span class="nf">recursive_checks_from_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check/uncheck all parent items.</span>

<span class="sd">        :param child: child item</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_state</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_module_view</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">check_state</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">parent</span><span class="p">():</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks_from_child</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># checked_children = []</span>
                <span class="c1"># for child in range(parent.childCount()):</span>
                <span class="c1">#</span>
                <span class="c1">#     if child.checkState(0) == Qt.Checked:</span>
                <span class="c1">#         checked_children.append()</span>

                <span class="n">checked_children</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span>
                                    <span class="nb">range</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">childCount</span><span class="p">())</span>
                                    <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">child</span><span class="p">)</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">checked_children</span><span class="p">:</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks_from_child</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibrary.set_module_view"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.set_module_view">[docs]</a>    <span class="k">def</span> <span class="nf">set_module_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set if a module has to be enabled or disabled in the process</span>
<span class="sd">        library.</span>

<span class="sd">        :param item: item selected in the current tree</span>
<span class="sd">        :param state: checked or not checked (Qt.Checked == 2. So if val ==</span>
<span class="sd">        2 -&gt; checkbox is checked, and if val == 0 -&gt; checkbox is not checked)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;process_enabled&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;process_disabled&#39;</span>

        <span class="n">list_path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_level_items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">())]</span>

        <span class="k">while</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_level_items</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
            <span class="n">list_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># pkg_iter take only the modules concerning the top package where a</span>
        <span class="c1"># change of status where done.</span>
        <span class="n">pkg_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_tree</span>
        <span class="n">list_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">list_path</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">list_path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="n">list_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Package not found&#39;</span><span class="p">)</span>
                <span class="k">break</span></div>

<div class="viewcode-block" id="PackageLibrary.update_checks"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibrary.update_checks">[docs]</a>    <span class="k">def</span> <span class="nf">update_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the checks of the tree from an item.</span>

<span class="sd">        :param item: item on which to begin</span>
<span class="sd">        :param column: column from the check (should always be 0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Checked state is stored on column 0</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">childCount</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">recursive_checks_from_child</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_checks</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PackageLibraryDialog"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog">[docs]</a><span class="k">class</span> <span class="nc">PackageLibraryDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Dialog that controls which processes to show in the process library.</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - add_package_with_text: add a package from the line edit&#39;s text</span>
<span class="sd">        - add_package: add a package and its modules to the package tree</span>
<span class="sd">        - browse_package: open a browser to select a package</span>
<span class="sd">        - import_file: import a python module from a path</span>
<span class="sd">        - load_config: update the config and loads the corresponding packages</span>
<span class="sd">        - load_packages: update the tree of the process library</span>
<span class="sd">        - remove_package: remove a package from the package tree</span>
<span class="sd">        - remove_package_with_text: remove the package in the line edit from</span>
<span class="sd">          the package tree</span>
<span class="sd">        - save: save the tree to the process_config.yml file</span>
<span class="sd">        - save_config: save the current config to process_config.yml</span>
<span class="sd">        - update_config: update the process_config and package_library</span>
<span class="sd">          attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">signal_save</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

<div class="viewcode-block" id="PackageLibraryDialog.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialization of the PackageLibraryDialog widget &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PackageLibraryDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Package library manager&quot;</span><span class="p">)</span>

        <span class="c1"># True if the path specified in the line edit is a path with &#39;/&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_path</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_packages</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span> <span class="o">=</span> <span class="n">PackageLibrary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
            <span class="s1">&#39;QLabel{font-size:10pt;font:italic;text-align: center}&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span>
            <span class="s1">&#39;Type a Python package (ex. nipype.interfaces.spm)&#39;</span><span class="p">)</span>

        <span class="sd">&#39;&#39;&#39;push_button_browse = QPushButton()</span>
<span class="sd">        push_button_browse.setText(&quot;Browse&quot;)</span>
<span class="sd">        push_button_browse.clicked.connect(self.browse_package)&#39;&#39;&#39;</span>

        <span class="n">push_button_add_pkg</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">push_button_add_pkg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Add package&quot;</span><span class="p">)</span>
        <span class="n">push_button_add_pkg</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_package_with_text</span><span class="p">)</span>

        <span class="n">push_button_rm_pkg</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">push_button_rm_pkg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Remove package&quot;</span><span class="p">)</span>
        <span class="n">push_button_rm_pkg</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_package_with_text</span><span class="p">)</span>

        <span class="n">push_button_save</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">push_button_save</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Save changes&quot;</span><span class="p">)</span>
        <span class="n">push_button_save</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">)</span>

        <span class="n">push_button_cancel</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">push_button_cancel</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;pushButton_cancel&quot;</span><span class="p">)</span>
        <span class="n">push_button_cancel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>

        <span class="c1"># Layout</span>

        <span class="n">h_box_line_edit</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">h_box_line_edit</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="p">)</span>
        <span class="c1"># h_box_line_edit.addWidget(push_button_add_pkg)</span>
        <span class="c1"># h_box_browse.addWidget(push_button_browse)</span>

        <span class="n">h_box_label</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">h_box_label</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">h_box_label</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="p">)</span>
        <span class="n">h_box_label</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">h_box_save</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">h_box_save</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">h_box_save</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_save</span><span class="p">)</span>
        <span class="n">h_box_save</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_cancel</span><span class="p">)</span>

        <span class="n">h_box_buttons</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">h_box_buttons</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">h_box_buttons</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_add_pkg</span><span class="p">)</span>
        <span class="n">h_box_buttons</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">h_box_buttons</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">push_button_rm_pkg</span><span class="p">)</span>
        <span class="n">h_box_buttons</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">v_box</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">h_box_label</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">h_box_line_edit</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">h_box_buttons</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">v_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">h_box_save</span><span class="p">)</span>

        <span class="n">h_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="p">)</span>
        <span class="n">h_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">v_box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">h_box</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.add_package"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.add_package">[docs]</a>    <span class="k">def</span> <span class="nf">add_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_name</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">init_package_tree</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a package and its modules to the package tree.</span>

<span class="sd">        :param module_name: name of the module</span>
<span class="sd">        :param class_name: name of the class</span>
<span class="sd">        :param show_error: display error in a message box in case of error. If</span>
<span class="sd">          False, errors are silent and error messages returned at the end of</span>
<span class="sd">          execution</span>
<span class="sd">        :param init_package_tree: boolean to initialize the package tree</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">init_package_tree</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_config</span><span class="p">()</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">module_name</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                            <span class="s1">&#39;processes&#39;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">)))</span>

            <span class="c1"># Reloading the package</span>
            <span class="k">if</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

            <span class="n">err_msg</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="nb">__import__</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span>
                <span class="n">pkg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>

                <span class="c1"># Checking if there are subpackages</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="s1">&#39;__path__&#39;</span><span class="p">):</span>

                    <span class="k">for</span> <span class="n">importer</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">ispkg</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">iter_modules</span><span class="p">(</span>
                            <span class="n">pkg</span><span class="o">.</span><span class="n">__path__</span><span class="p">):</span>

                        <span class="k">if</span> <span class="n">ispkg</span> <span class="ow">and</span> <span class="n">modname</span> <span class="o">!=</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
                            <span class="n">err_msg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">module_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">modname</span><span class="p">),</span> <span class="n">class_name</span><span class="p">,</span>
                                <span class="n">show_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pkg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())):</span>

                    <span class="c1"># Checking each class of in the package</span>
                    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">get_process_instance</span><span class="p">(</span>
                                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">module_name</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
                            <span class="c1"># TODO: WHICH TYPE OF EXCEPTION?</span>
                            <span class="c1"># pass</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Updating the tree&#39;s dictionnary</span>
                            <span class="n">path_list</span> <span class="o">=</span> <span class="n">module_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                            <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                            <span class="n">pkg_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
                            <span class="n">recurs</span> <span class="o">=</span> <span class="kc">False</span>

                            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">:</span>

                                <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">class_name</span><span class="p">:</span>
                                    <span class="n">recurs</span> <span class="o">=</span> <span class="kc">True</span>

                                <span class="k">if</span> <span class="p">(</span><span class="n">element</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">element</span> <span class="ow">is</span>
                                        <span class="ow">not</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                                    <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

                                <span class="k">else</span><span class="p">:</span>

                                    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>

                                        <span class="k">if</span> <span class="p">(</span><span class="n">element</span> <span class="o">==</span> <span class="n">class_name</span> <span class="ow">or</span> <span class="n">recurs</span>
                                                <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
                                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Enabling </span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> ...&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                                <span class="n">module_name</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                                            <span class="n">pkg_iter</span><span class="p">[</span>
                                                <span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;process_enabled&#39;</span>

                                        <span class="k">elif</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                            <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

                                        <span class="k">else</span><span class="p">:</span>
                                            <span class="nb">print</span><span class="p">(</span>
                                                <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">A not installed pipeline &#39;</span>
                                                <span class="s1">&#39;was detected in the </span><span class="si">%s</span><span class="s1"> &#39;</span>
                                                <span class="s1">&#39;library:&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- </span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> ...&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                                <span class="n">module_name</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                                            <span class="nb">print</span><span class="p">(</span>
                                                <span class="s1">&#39;This pipeline is now &#39;</span>
                                                <span class="s1">&#39;installed but disabled &#39;</span>
                                                <span class="s1">&#39;(see File &gt; Package Library &#39;</span>
                                                <span class="s1">&#39;Manager to enable it) ...&#39;</span><span class="p">)</span>
                                            <span class="n">pkg_iter</span><span class="p">[</span>
                                                <span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;process_disabled&#39;</span>

                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                                        <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span>
                <span class="c1"># self.save_config()</span>
                <span class="k">return</span> <span class="n">err_msg</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">err_msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;in </span><span class="si">{2}</span><span class="s2">: </span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span>
                                                          <span class="n">module_name</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">show_error</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">err_msg</span><span class="p">))</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">err_msg</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;No package selected!&#39;</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.add_package_with_text"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.add_package_with_text">[docs]</a>    <span class="k">def</span> <span class="nf">add_package_with_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a package from the line edit&#39;s text.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_path</span><span class="p">:</span>  <span class="c1"># Currently the self.is_path = False</span>
            <span class="c1"># (Need to pass by the method browse_package to initialise to</span>
            <span class="c1"># True and the Browse button is commented.</span>
            <span class="c1"># Could be interesting to permit a backdoor to pass</span>
            <span class="c1"># the absolute path in the field for add package,</span>
            <span class="c1"># to be continued... )</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">package</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="c1"># Adding the module path to the system path</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.package_library.package_tree = self.load_config()[&#39;Packages&#39;]</span>
            <span class="n">old_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;Adding </span><span class="si">{0}</span><span class="s2">. Please wait.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
            <span class="n">_2add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_2add</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">part</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">old_part</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">_2add</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
                    <span class="n">part</span> <span class="o">+=</span> <span class="n">content</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">__import__</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

                    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

                            <span class="k">if</span> <span class="n">content</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">old_part</span><span class="p">]):</span>
                                <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_2add</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_2add</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                                <span class="k">break</span>

                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span><span class="n">_2add</span><span class="p">)</span>
                                <span class="k">break</span>

                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;No package, module or class named &#39;</span> <span class="o">+</span> <span class="n">_2add</span> <span class="o">+</span> <span class="s1">&#39; !&#39;</span>
                            <span class="k">break</span>

                    <span class="n">old_part</span> <span class="o">=</span> <span class="n">part</span>
                    <span class="n">part</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span>

                <span class="k">if</span> <span class="n">flag</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_2add</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_2add</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_package</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_2add</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_2add</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> added to the Package Library.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">old_status</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>

                <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.browse_package"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.browse_package">[docs]</a>    <span class="k">def</span> <span class="nf">browse_package</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open a browser to select a package.&quot;&quot;&quot;</span>

        <span class="n">file_dialog</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">file_dialog</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">DontUseNativeDialog</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># To select files or directories, we should use a proxy model</span>
        <span class="c1"># but mine is not working yet...</span>

        <span class="c1"># file_dialog.setProxyModel(FileFilterProxyModel())</span>
        <span class="n">file_dialog</span><span class="o">.</span><span class="n">setFileMode</span><span class="p">(</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">Directory</span><span class="p">)</span>
        <span class="c1"># file_dialog.setFileMode(QFileDialog.Directory |</span>
        <span class="c1"># QFileDialog.ExistingFile)</span>
        <span class="c1"># file_dialog.setFilter(&quot;Processes (*.py *.xml)&quot;)</span>

        <span class="k">if</span> <span class="n">file_dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_dialog</span><span class="o">.</span><span class="n">selectedFiles</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_path</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.load_config"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.load_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_config</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Update the config and loads the corresponding packages.</span>

<span class="sd">        :return: the config as a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verCmp</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">__version__</span><span class="p">,</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span> <span class="s1">&#39;sup&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.load_packages"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.load_packages">[docs]</a>    <span class="k">def</span> <span class="nf">load_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the tree of the process library.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.remove_package_with_text"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.remove_package_with_text">[docs]</a>    <span class="k">def</span> <span class="nf">remove_package_with_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the package in the line edit from the package tree.&quot;&quot;&quot;</span>

        <span class="n">old_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="s2">&quot;Removing </span><span class="si">{0}</span><span class="s2">. Please wait.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">package_removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_package</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">package_removed</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> removed from Package Library.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">line_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">old_status</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.remove_package"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.remove_package">[docs]</a>    <span class="k">def</span> <span class="nf">remove_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a package from the package tree.</span>

<span class="sd">        :param package: module&#39;s representation as a string</span>
<span class="sd">           (e.g.: nipype.interfaces.spm)</span>
<span class="sd">        :return: True if the package has been removed correctly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">package</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span>
                                            <span class="s1">&#39;processes&#39;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;processes&#39;</span><span class="p">)))</span>

            <span class="n">path_list</span> <span class="o">=</span> <span class="n">package</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">pkg_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>

            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">pkg_iter</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                    <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">pkg_iter</span> <span class="o">=</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">pkg_iter</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span>
                        <span class="s2">&quot;Warning: Package not found in Package Library&quot;</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Package </span><span class="si">{0}</span><span class="s2"> not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package</span><span class="p">))</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
                    <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">None</span>
                    <span class="c1"># break</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Warning</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Warning: Package not found in Package Library&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;No package selected!&quot;</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">buttonClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">close</span><span class="p">)</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.save"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the tree to the process_config.yml file.&quot;&quot;&quot;</span>
        <span class="c1"># Updating the packages and the paths according to the</span>
        <span class="c1"># package library tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">paths</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Packages&quot;</span><span class="p">):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Paths&quot;</span><span class="p">):</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paths</span><span class="p">))</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> \
                <span class="k">as</span> <span class="n">configfile</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">,</span> <span class="n">configfile</span><span class="p">,</span>
                      <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signal_save</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.save_config"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.save_config">[docs]</a>    <span class="k">def</span> <span class="nf">save_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the current config to process_config.yml.&quot;&quot;&quot;</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Packages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">[</span><span class="s2">&quot;Paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get_mia_path</span><span class="p">(),</span> <span class="s1">&#39;properties&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;process_config.yml&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> \
                <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_config</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="PackageLibraryDialog.update_config"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.PackageLibraryDialog.update_config">[docs]</a>    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the process_config and package_library attributes.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_packages</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">package_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_library</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="ProcessHelp"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessHelp">[docs]</a><span class="k">class</span> <span class="nc">ProcessHelp</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A widget that displays information about the selected process.</span>

<span class="sd">    :param process: selected process</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ProcessHelp.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessHelp.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate the help.</span>

<span class="sd">         :param process: selected process</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ProcessHelp</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">process</span><span class="o">.</span><span class="n">help</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="ProcessLibrary"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary">[docs]</a><span class="k">class</span> <span class="nc">ProcessLibrary</span><span class="p">(</span><span class="n">QTreeView</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tree to display the available Capsul&#39;s processes</span>

<span class="sd">    :param d: dictionary: dictionary corresponding to the tree</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - load_dictionary: loads a dictionary to the tree</span>
<span class="sd">        - to_dict: returns a dictionary from the current tree</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item_library_clicked</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<div class="viewcode-block" id="ProcessLibrary.__init__"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialization of the ProcessLibrary class.</span>

<span class="sd">        :param d: dictionary: dictionary corresponding to the tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ProcessLibrary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_dictionary</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessLibrary.load_dictionary"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.load_dictionary">[docs]</a>    <span class="k">def</span> <span class="nf">load_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a dictionary to the tree.</span>

<span class="sd">        :param d: dictionary to load. See the packages attribute in the</span>
<span class="sd">        ProcessLibraryWidget class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="o">=</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span> <span class="o">=</span> <span class="n">node_structure_from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">DictionaryTreeModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expandAll</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessLibrary.to_dict"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a dictionary from the current tree.</span>

<span class="sd">        :return: the dictionary of the tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessLibrary.mousePressEvent"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.ProcessLibrary.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Event when the mouse is pressed.&quot;&quot;&quot;</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexAt</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
        <span class="c1"># print(&#39;idx&#39;,dir(idx.model()))</span>
        <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">isValid</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">sibling</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">internalPointer</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">column</span><span class="p">())</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
                <span class="c1"># print(&#39;dictionary &#39;,path.decode(&#39;utf8&#39;))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_library_clicked</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span>
                <span class="c1"># self.item_library_clicked.emit(model.itemData(idx)[0])</span>

        <span class="k">return</span> <span class="n">QTreeView</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="import_file"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.import_file">[docs]</a><span class="k">def</span> <span class="nf">import_file</span><span class="p">(</span><span class="n">full_name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import a python module from a path (3.4+ only).</span>

<span class="sd">    Does not call sys.modules[full_name] = path</span>

<span class="sd">    :param full_name: name of the package</span>
<span class="sd">    :param path: path of the package</span>
<span class="sd">    :return: the corresponding module</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">importlib</span> <span class="k">import</span> <span class="n">util</span>

    <span class="n">spec</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">spec_from_file_location</span><span class="p">(</span><span class="n">full_name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

    <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mod</span></div>


<div class="viewcode-block" id="node_structure_from_dict"><a class="viewcode-back" href="../../../../populse_mia.user_interface.pipeline_manager.html#populse_mia.user_interface.pipeline_manager.process_library.node_structure_from_dict">[docs]</a><span class="k">def</span> <span class="nf">node_structure_from_dict</span><span class="p">(</span><span class="n">datadict</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root_node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a hierarchical node stucture required by the TreeModel.</span>

<span class="sd">    :param datadict: dictionary</span>
<span class="sd">    :param parent: Parent of the node</span>
<span class="sd">    :param root_node: Root of the node</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
        <span class="n">root_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s1">&#39;Root&#39;</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">root_node</span>

    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">datadict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>

            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span>
                        <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;process_enabled&#39;</span><span class="p">]:</span>
                <span class="n">list_name</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span>
                             <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;process_enabled&#39;</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">list_name</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">list_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span>
                               <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]</span>

                <span class="k">while</span> <span class="p">(</span><span class="n">list_values</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">list_values</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="n">list_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                    <span class="n">list_values</span> <span class="o">=</span> <span class="n">list_values</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span>
                                                 <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]</span>

            <span class="c1"># if not list_name: list_name = [i for i in data.values()]</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="s1">&#39;process_disabled&#39;</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_name</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node_structure_from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">root_node</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;process_enabled&#39;</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">return</span> <span class="n">root_node</span></div>


<span class="c1"># class FileFilterProxyModel(QSortFilterProxyModel):</span>
<span class="c1">#     &quot;&quot;&quot;Just a test for the moment. Should be useful to use in</span>
<span class="c1">#        the file dialog.</span>
<span class="c1">#</span>
<span class="c1">#     .. Methods:</span>
<span class="c1">#         - filterAcceptsRow:</span>
<span class="c1">#</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#     def __init__(self):</span>
<span class="c1">#         &quot;&quot;&quot;Initialization of the FileFilterProxyModel class.&quot;&quot;&quot;</span>
<span class="c1">#         super(FileFilterProxyModel, self).__init__()</span>
<span class="c1">#</span>
<span class="c1">#     def filterAcceptsRow(self, source_row, source_parent):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1">#         :param source_row:</span>
<span class="c1">#         :param source_parent:</span>
<span class="c1">#         :return: boolean</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         source_model = self.sourceModel()</span>
<span class="c1">#         index0 = source_model.index(source_row, 0, source_parent)</span>
<span class="c1">#         # Always show directories</span>
<span class="c1">#         if source_model.isDir(index0):</span>
<span class="c1">#             return True</span>
<span class="c1">#         # filter files</span>
<span class="c1">#         filename = source_model.fileName(index0)</span>
<span class="c1">#         #       filename=self.sourceModel().index(row,0,parent).data().lower()</span>
<span class="c1">#         # return True</span>
<span class="c1">#         if filename.count(&quot;.py&quot;) + filename.count(&quot;.xml&quot;) == 0:</span>
<span class="c1">#             return False</span>
<span class="c1">#         else:</span>
<span class="c1">#             return True</span>
<span class="c1">#</span>
<span class="c1">#     def flags(self, index):</span>
<span class="c1">#         flags = super(FileFilterProxyModel, self).flags(index)</span>
<span class="c1">#         source_model = self.sourceModel()</span>
<span class="c1">#         if source_model.isDir(index):</span>
<span class="c1">#             flags |= Qt.ItemIsSelectable</span>
<span class="c1">#             return flags</span>
<span class="c1">#</span>
<span class="c1">#         # filter files</span>
<span class="c1">#         filename = source_model.fileName(index)</span>
<span class="c1">#</span>
<span class="c1">#         if filename.count(&quot;.py&quot;) + filename.count(&quot;.xml&quot;) == 0:</span>
<span class="c1">#             flags &amp;= ~Qt.ItemIsSelectable</span>
<span class="c1">#             return flags</span>
<span class="c1">#         else:</span>
<span class="c1">#             flags |= Qt.ItemIsSelectable</span>
<span class="c1">#             return flags</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;using Qt backend:&#39;</span><span class="p">,</span> <span class="n">qt_backend</span><span class="o">.</span><span class="n">get_qt_backend</span><span class="p">())</span>
    <span class="n">plw</span> <span class="o">=</span> <span class="n">ProcessLibraryWidget</span><span class="p">()</span>
    <span class="n">plw</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, populse.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>